<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Interface · Mooncake.jl</title><meta name="title" content="Interface · Mooncake.jl"/><meta property="og:title" content="Interface · Mooncake.jl"/><meta property="twitter:title" content="Interface · Mooncake.jl"/><meta name="description" content="Documentation for Mooncake.jl."/><meta property="og:description" content="Documentation for Mooncake.jl."/><meta property="twitter:description" content="Documentation for Mooncake.jl."/><script data-outdated-warner src="../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../search_index.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../">Mooncake.jl</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../">Mooncake.jl</a></li><li><a class="tocitem" href="../tutorial/">Tutorial</a></li><li class="is-active"><a class="tocitem" href>Interface</a></li><li><span class="tocitem">Understanding Mooncake.jl</span><ul><li><a class="tocitem" href="../understanding_mooncake/introduction/">Introduction</a></li><li><a class="tocitem" href="../understanding_mooncake/algorithmic_differentiation/">Algorithmic Differentiation</a></li><li><a class="tocitem" href="../understanding_mooncake/rule_system/">Mooncake.jl&#39;s Rule System</a></li></ul></li><li><span class="tocitem">Utilities</span><ul><li><a class="tocitem" href="../utilities/defining_rules/">Defining Rules</a></li><li><a class="tocitem" href="../utilities/debug_mode/">Debug Mode</a></li><li><a class="tocitem" href="../utilities/debugging_and_mwes/">Debugging and MWEs</a></li></ul></li><li><span class="tocitem">Developer Documentation</span><ul><li><a class="tocitem" href="../developer_documentation/running_tests_locally/">Running Tests Locally</a></li><li><a class="tocitem" href="../developer_documentation/developer_tools/">Developer Tools</a></li><li><a class="tocitem" href="../developer_documentation/forwards_mode_design/">Forwards-Mode Design</a></li><li><a class="tocitem" href="../developer_documentation/misc_internals_notes/">Misc. Internals Notes</a></li><li><a class="tocitem" href="../developer_documentation/internal_docstrings/">Internal Docstrings</a></li></ul></li><li><a class="tocitem" href="../known_limitations/">Known Limitations</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href>Interface</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Interface</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/compintell/Mooncake.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/compintell/Mooncake.jl/blob/main/docs/src/interface.md" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="Interface"><a class="docs-heading-anchor" href="#Interface">Interface</a><a id="Interface-1"></a><a class="docs-heading-anchor-permalink" href="#Interface" title="Permalink"></a></h1><p>This is the public interface that day-to-day users of AD are expected to interact with if for some reason DifferentiationInterface.jl does not suffice. If you have not tried using Mooncake.jl via DifferentiationInterface.jl, please do so. See <a href="../tutorial/#Tutorial">Tutorial</a> for more info.</p><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Mooncake.Config" href="#Mooncake.Config"><code>Mooncake.Config</code></a> — <span class="docstring-category">Type</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">Config(; debug_mode=false, silence_debug_messages=false)</code></pre><p>Configuration struct for use with <code>ADTypes.AutoMooncake</code>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/compintell/Mooncake.jl/blob/b03f6d1694691b331f8d8240f530a6d45a013af3/src/config.jl#L1-L5">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Mooncake.value_and_gradient!!-Union{Tuple{N}, Tuple{F}, Tuple{Mooncake.Cache, F, Vararg{Any, N}}} where {F, N}" href="#Mooncake.value_and_gradient!!-Union{Tuple{N}, Tuple{F}, Tuple{Mooncake.Cache, F, Vararg{Any, N}}} where {F, N}"><code>Mooncake.value_and_gradient!!</code></a> — <span class="docstring-category">Method</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">value_and_gradient!!(cache::Cache, f, x...)</code></pre><p>Computes a 2-tuple. The first element is <code>f(x...)</code>, and the second is a tuple containing the gradient of <code>f</code> w.r.t. each argument. The first element is the gradient w.r.t any differentiable fields of <code>f</code>, the second w.r.t the first element of <code>x</code>, etc.</p><p>Assumes that <code>f</code> returns a <code>Union{Float16, Float32, Float64}</code>.</p><p>As with all functionality in Mooncake, if <code>f</code> modifes itself or <code>x</code>, <code>value_and_gradient!!</code> will return both to their original state as part of the process of computing the gradient.</p><div class="admonition is-info"><header class="admonition-header">Info</header><div class="admonition-body"><p><code>cache</code> must be the output of <a href="#Mooncake.prepare_gradient_cache"><code>prepare_gradient_cache</code></a>, and (fields of) <code>f</code> and <code>x</code> must be of the same size and shape as those used to construct the <code>cache</code>. This is to ensure that the gradient can be written to the memory allocated when the <code>cache</code> was built.</p></div></div><div class="admonition is-warning"><header class="admonition-header">Warning</header><div class="admonition-body"><p><code>cache</code> owns any mutable state returned by this function, meaning that mutable components of values returned by it will be mutated if you run this function again with different arguments. Therefore, if you need to keep the values returned by this function around over multiple calls to this function with the same <code>cache</code>, you should take a copy (using <code>copy</code> or <code>deepcopy</code>) of them before calling again.</p></div></div><p><strong>Example Usage</strong></p><pre><code class="language-julia hljs">f(x, y) = sum(x .* y)
x = [2.0, 2.0]
y = [1.0, 1.0]
cache = prepare_gradient_cache(f, x, y)
value_and_gradient!!(cache, f, x, y)

# output

(4.0, (NoTangent(), [1.0, 1.0], [2.0, 2.0]))</code></pre></div><a class="docs-sourcelink" target="_blank" href="https://github.com/compintell/Mooncake.jl/blob/b03f6d1694691b331f8d8240f530a6d45a013af3/src/interface.jl#L260-L297">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Mooncake.value_and_pullback!!-Union{Tuple{N}, Tuple{F}, Tuple{Mooncake.Cache, Any, F, Vararg{Any, N}}} where {F, N}" href="#Mooncake.value_and_pullback!!-Union{Tuple{N}, Tuple{F}, Tuple{Mooncake.Cache, Any, F, Vararg{Any, N}}} where {F, N}"><code>Mooncake.value_and_pullback!!</code></a> — <span class="docstring-category">Method</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">value_and_pullback!!(cache::Cache, ȳ, f, x...)</code></pre><div class="admonition is-info"><header class="admonition-header">Info</header><div class="admonition-body"><p>If <code>f(x...)</code> returns a scalar, you should use <a href="#Mooncake.value_and_gradient!!-Union{Tuple{N}, Tuple{F}, Tuple{Mooncake.Cache, F, Vararg{Any, N}}} where {F, N}"><code>value_and_gradient!!</code></a>, not this function.</p></div></div><p>Computes a 2-tuple. The first element is <code>f(x...)</code>, and the second is a tuple containing the pullback of <code>f</code> applied to <code>ȳ</code>. The first element is the component of the pullback associated to any fields of <code>f</code>, the second w.r.t the first element of <code>x</code>, etc.</p><p>There are no restrictions on what <code>y = f(x...)</code> is permitted to return. However, <code>ȳ</code> must be an acceptable tangent for <code>y</code>. This means that, for example, it must be true that <code>tangent_type(typeof(y)) == typeof(ȳ)</code>.</p><p>As with all functionality in Mooncake, if <code>f</code> modifes itself or <code>x</code>, <code>value_and_gradient!!</code> will return both to their original state as part of the process of computing the gradient.</p><div class="admonition is-info"><header class="admonition-header">Info</header><div class="admonition-body"><p><code>cache</code> must be the output of <a href="#Mooncake.prepare_pullback_cache"><code>prepare_pullback_cache</code></a>, and (fields of) <code>f</code> and <code>x</code> must be of the same size and shape as those used to construct the <code>cache</code>. This is to ensure that the gradient can be written to the memory allocated when the <code>cache</code> was built.</p></div></div><div class="admonition is-warning"><header class="admonition-header">Warning</header><div class="admonition-body"><p><code>cache</code> owns any mutable state returned by this function, meaning that mutable components of values returned by it will be mutated if you run this function again with different arguments. Therefore, if you need to keep the values returned by this function around over multiple calls to this function with the same <code>cache</code>, you should take a copy (using <code>copy</code> or <code>deepcopy</code>) of them before calling again.</p></div></div><p><strong>Example Usage</strong></p><pre><code class="language-julia hljs">f(x, y) = sum(x .* y)
x = [2.0, 2.0]
y = [1.0, 1.0]
cache = Mooncake.prepare_pullback_cache(f, x, y)
Mooncake.value_and_pullback!!(cache, 1.0, f, x, y)

# output

(4.0, (NoTangent(), [1.0, 1.0], [2.0, 2.0]))</code></pre></div><a class="docs-sourcelink" target="_blank" href="https://github.com/compintell/Mooncake.jl/blob/b03f6d1694691b331f8d8240f530a6d45a013af3/src/interface.jl#L197-L240">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Mooncake.prepare_gradient_cache" href="#Mooncake.prepare_gradient_cache"><code>Mooncake.prepare_gradient_cache</code></a> — <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">prepare_gradient_cache(f, x...)</code></pre><p>Returns a cache used with <a href="#Mooncake.value_and_gradient!!-Union{Tuple{N}, Tuple{F}, Tuple{Mooncake.Cache, F, Vararg{Any, N}}} where {F, N}"><code>value_and_gradient!!</code></a>. See that function for more info.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/compintell/Mooncake.jl/blob/b03f6d1694691b331f8d8240f530a6d45a013af3/src/interface.jl#L247-L251">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Mooncake.prepare_pullback_cache" href="#Mooncake.prepare_pullback_cache"><code>Mooncake.prepare_pullback_cache</code></a> — <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">prepare_pullback_cache(f, x...)</code></pre><p>Returns a cache used with <a href="#Mooncake.value_and_pullback!!-Union{Tuple{N}, Tuple{F}, Tuple{Mooncake.Cache, Any, F, Vararg{Any, N}}} where {F, N}"><code>value_and_pullback!!</code></a>. See that function for more info.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/compintell/Mooncake.jl/blob/b03f6d1694691b331f8d8240f530a6d45a013af3/src/interface.jl#L175-L179">source</a></section></article></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../tutorial/">« Tutorial</a><a class="docs-footer-nextpage" href="../understanding_mooncake/introduction/">Introduction »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.8.1 on <span class="colophon-date" title="Wednesday 26 February 2025 15:37">Wednesday 26 February 2025</span>. Using Julia version 1.11.3.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
