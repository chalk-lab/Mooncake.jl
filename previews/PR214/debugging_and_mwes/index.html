<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Debugging and MWEs · Tapir.jl</title><meta name="title" content="Debugging and MWEs · Tapir.jl"/><meta property="og:title" content="Debugging and MWEs · Tapir.jl"/><meta property="twitter:title" content="Debugging and MWEs · Tapir.jl"/><meta name="description" content="Documentation for Tapir.jl."/><meta property="og:description" content="Documentation for Tapir.jl."/><meta property="twitter:description" content="Documentation for Tapir.jl."/><script data-outdated-warner src="../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../search_index.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../">Tapir.jl</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../">Tapir.jl</a></li><li><span class="tocitem">Understanding Tapir.jl</span><ul><li><a class="tocitem" href="../understanding_intro/">Introduction</a></li><li><a class="tocitem" href="../algorithmic_differentiation/">Algorithmic Differentiation</a></li><li><a class="tocitem" href="../mathematical_interpretation/">Tapir.jl&#39;s Rule System</a></li></ul></li><li><a class="tocitem" href="../known_limitations/">Known Limitations</a></li><li><a class="tocitem" href="../safe_mode/">Safe Mode</a></li><li class="is-active"><a class="tocitem" href>Debugging and MWEs</a><ul class="internal"><li><a class="tocitem" href="#Example"><span>Example</span></a></li><li><a class="tocitem" href="#Segfaults"><span>Segfaults</span></a></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href>Debugging and MWEs</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Debugging and MWEs</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/compintell/Tapir.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/compintell/Tapir.jl/blob/main/docs/src/debugging_and_mwes.md" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="Debugging-and-MWEs"><a class="docs-heading-anchor" href="#Debugging-and-MWEs">Debugging and MWEs</a><a id="Debugging-and-MWEs-1"></a><a class="docs-heading-anchor-permalink" href="#Debugging-and-MWEs" title="Permalink"></a></h1><p>There&#39;s a reasonable chance that you&#39;ll run into an issue with Tapir.jl at some point. In order to debug what is going on when this happens, or to produce an MWE, it is helpful to have a convenient way to run Tapir.jl on whatever function and arguments you have which are causing problems.</p><p>We recommend making use of Tapir.jl&#39;s testing functionality to generate your test cases:</p><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Tapir.TestUtils.test_rule" href="#Tapir.TestUtils.test_rule"><code>Tapir.TestUtils.test_rule</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">test_rule(
    rng, x...;
    interface_only=false,
    has_rrule!!=true,
    perf_flag::Symbol,
    ctx=DefaultCtx(),
    safety_on=false,
)</code></pre><p>Run standardised tests on the <code>rule</code> for <code>x</code>. The first element of <code>x</code> should be the primal function to test, and each other element a positional argument. In most cases, elements of <code>x</code> can just be the primal values, and <code>randn_tangent</code> can be relied upon to generate an appropriate tangent to test. Some notable exceptions exist though, in partcular <code>Ptr</code>s. In this case, the argument for which <code>randn_tangent</code> cannot be readily defined should be a <code>CoDual</code> containing the primal, and a <em>manually</em> constructed tangent field.</p><p>This function uses <a href="../safe_mode/#Tapir.build_rrule"><code>Tapir.build_rrule</code></a> to construct a rule. This will use an <code>rrule!!</code> if one exists, and derive a rule otherwise.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/compintell/Tapir.jl/blob/a0082e32a75980ea9f267363cef5f659c9082224/src/test_utils.jl#L418-L439">source</a></section></article><p>This approach is convenient because it can</p><ol><li>check whether AD runs at all,</li><li>check whether AD produces the correct answers,</li><li>check whether AD is performant, and</li><li>can be used without having to manually generate tangents.</li></ol><h2 id="Example"><a class="docs-heading-anchor" href="#Example">Example</a><a id="Example-1"></a><a class="docs-heading-anchor-permalink" href="#Example" title="Permalink"></a></h2><p>For example</p><pre><code class="language-julia hljs">f(x) = Core.bitcast(Float64, x)
Tapir.TestUtils.test_rule(
    Random.Xoshiro(123), f, 3;
    is_primitive=false, perf_flag=:none, interp=Tapir.TapirInterpreter(),
)</code></pre><p>will error. (In this particular case, it is caused by Tapir.jl preventing you from doing (potentially) unsafe casting. In this particular instance, Tapir.jl just fails to compile, but in other instances other things can happen.)</p><p>In any case, the point here is that <code>Tapir.TestUtils.test_rule</code> provides a convenient way to produce and report an error.</p><h2 id="Segfaults"><a class="docs-heading-anchor" href="#Segfaults">Segfaults</a><a id="Segfaults-1"></a><a class="docs-heading-anchor-permalink" href="#Segfaults" title="Permalink"></a></h2><p>These are everyone&#39;s least favourite kind of problem, and they should be <em>extremely</em> rare in Tapir.jl. However, if you are unfortunate enough to encounter one, please re-run your problem with the <code>safety_on</code> kwarg set to <code>true</code>. See <a href="../safe_mode/#Safe-Mode">Safe Mode</a> for more info. In general, this will catch problems before they become segfaults, at which point the above strategy for debugging and error reporting should work well.</p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../safe_mode/">« Safe Mode</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.5.0 on <span class="colophon-date" title="Saturday 3 August 2024 20:47">Saturday 3 August 2024</span>. Using Julia version 1.10.4.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
