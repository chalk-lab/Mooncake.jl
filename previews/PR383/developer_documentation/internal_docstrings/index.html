<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Internal Docstrings · Mooncake.jl</title><meta name="title" content="Internal Docstrings · Mooncake.jl"/><meta property="og:title" content="Internal Docstrings · Mooncake.jl"/><meta property="twitter:title" content="Internal Docstrings · Mooncake.jl"/><meta name="description" content="Documentation for Mooncake.jl."/><meta property="og:description" content="Documentation for Mooncake.jl."/><meta property="twitter:description" content="Documentation for Mooncake.jl."/><script data-outdated-warner src="../../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../search_index.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../../">Mooncake.jl</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../../">Mooncake.jl</a></li><li><span class="tocitem">Understanding Mooncake.jl</span><ul><li><a class="tocitem" href="../../understanding_mooncake/introduction/">Introduction</a></li><li><a class="tocitem" href="../../understanding_mooncake/algorithmic_differentiation/">Algorithmic Differentiation</a></li><li><a class="tocitem" href="../../understanding_mooncake/rule_system/">Mooncake.jl&#39;s Rule System</a></li></ul></li><li><span class="tocitem">Utilities</span><ul><li><a class="tocitem" href="../../utilities/tools_for_rules/">Tools for Rules</a></li><li><a class="tocitem" href="../../utilities/debug_mode/">Debug Mode</a></li><li><a class="tocitem" href="../../utilities/debugging_and_mwes/">Debugging and MWEs</a></li></ul></li><li><span class="tocitem">Developer Documentation</span><ul><li><a class="tocitem" href="../running_tests_locally/">Running Tests Locally</a></li><li><a class="tocitem" href="../developer_tools/">Developer Tools</a></li><li class="is-active"><a class="tocitem" href>Internal Docstrings</a></li></ul></li><li><a class="tocitem" href="../../known_limitations/">Known Limitations</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Developer Documentation</a></li><li class="is-active"><a href>Internal Docstrings</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Internal Docstrings</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/compintell/Mooncake.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/compintell/Mooncake.jl/blob/main/docs/src/developer_documentation/internal_docstrings.md" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="Internal-Docstrings"><a class="docs-heading-anchor" href="#Internal-Docstrings">Internal Docstrings</a><a id="Internal-Docstrings-1"></a><a class="docs-heading-anchor-permalink" href="#Internal-Docstrings" title="Permalink"></a></h1><p>Docstrings listed here are <em>not</em> part of the public Mooncake.jl interface. Consequently, they can change between non-breaking changes to Mooncake.jl without warning. Its purpose is to make it easy for developers to find docstrings straightforward via the docs, as opposed to having to ctrl+f through Mooncake.jl&#39;s source, or having a Julia session active.</p><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Mooncake.GLOBAL_INTERPRETER-developer_documentation-internal_docstrings" href="#Mooncake.GLOBAL_INTERPRETER-developer_documentation-internal_docstrings"><code>Mooncake.GLOBAL_INTERPRETER</code></a> — <span class="docstring-category">Constant</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">const GLOBAL_INTERPRETER</code></pre><p>Globally cached interpreter. Should only be accessed via <code>get_interpreter</code>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/compintell/Mooncake.jl/blob/9f19358ec93a14f67ccd63773de4a19f4c9f35fd/src/interpreter/abstract_interpretation.jl#L64-L68">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Mooncake.Terminator-developer_documentation-internal_docstrings" href="#Mooncake.Terminator-developer_documentation-internal_docstrings"><code>Mooncake.Terminator</code></a> — <span class="docstring-category">Type</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">Terminator = Union{Switch, IDGotoIfNot, IDGotoNode, ReturnNode}</code></pre><p>A Union of the possible types of a terminator node.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/compintell/Mooncake.jl/blob/9f19358ec93a14f67ccd63773de4a19f4c9f35fd/src/interpreter/bbcode.jl#L103-L107">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Core.Compiler.IRCode-Tuple{Mooncake.BBCode}-developer_documentation-internal_docstrings" href="#Core.Compiler.IRCode-Tuple{Mooncake.BBCode}-developer_documentation-internal_docstrings"><code>Core.Compiler.IRCode</code></a> — <span class="docstring-category">Method</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">IRCode(bb_code::BBCode)</code></pre><p>Produce an <code>IRCode</code> instance which is equivalent to <code>bb_code</code>. The resulting <code>IRCode</code> shares no memory with <code>bb_code</code>, so can be safely mutated without modifying <code>bb_code</code>.</p><p>All <code>IDPhiNode</code>s, <code>IDGotoIfNot</code>s, and <code>IDGotoNode</code>s are converted into <code>PhiNode</code>s, <code>GotoIfNot</code>s, and <code>GotoNode</code>s respectively.</p><p>In the resulting <code>bb_code</code>, any <code>Switch</code> nodes are lowered into a semantically-equivalent collection of <code>GotoIfNot</code> nodes.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/compintell/Mooncake.jl/blob/9f19358ec93a14f67ccd63773de4a19f4c9f35fd/src/interpreter/bbcode.jl#L497-L508">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Mooncake.BBCode-Tuple{Core.Compiler.IRCode}-developer_documentation-internal_docstrings" href="#Mooncake.BBCode-Tuple{Core.Compiler.IRCode}-developer_documentation-internal_docstrings"><code>Mooncake.BBCode</code></a> — <span class="docstring-category">Method</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">BBCode(ir::IRCode)</code></pre><p>Convert an <code>ir</code> into a <code>BBCode</code>. Creates a completely independent data structure, so mutating the <code>BBCode</code> returned will not mutate <code>ir</code>.</p><p>All <code>PhiNode</code>s, <code>GotoIfNot</code>s, and <code>GotoNode</code>s will be replaced with the <code>IDPhiNode</code>s, <code>IDGotoIfNot</code>s, and <code>IDGotoNode</code>s respectively.</p><p>See <code>IRCode</code> for conversion back to <code>IRCode</code>.</p><p>Note that <code>IRCode(BBCode(ir))</code> should be equal to the identity function.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/compintell/Mooncake.jl/blob/9f19358ec93a14f67ccd63773de4a19f4c9f35fd/src/interpreter/bbcode.jl#L405-L417">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Mooncake.BBCode-Tuple{Union{Core.Compiler.IRCode, Mooncake.BBCode}, Vector{Mooncake.BBlock}}-developer_documentation-internal_docstrings" href="#Mooncake.BBCode-Tuple{Union{Core.Compiler.IRCode, Mooncake.BBCode}, Vector{Mooncake.BBlock}}-developer_documentation-internal_docstrings"><code>Mooncake.BBCode</code></a> — <span class="docstring-category">Method</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">BBCode(ir::Union{IRCode, BBCode}, new_blocks::Vector{Block})</code></pre><p>Make a new <code>BBCode</code> whose <code>blocks</code> is given by <code>new_blocks</code>, and fresh copies are made of all other fields from <code>ir</code>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/compintell/Mooncake.jl/blob/9f19358ec93a14f67ccd63773de4a19f4c9f35fd/src/interpreter/bbcode.jl#L258-L263">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Mooncake.BBCode-developer_documentation-internal_docstrings" href="#Mooncake.BBCode-developer_documentation-internal_docstrings"><code>Mooncake.BBCode</code></a> — <span class="docstring-category">Type</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">BBCode(
    blocks::Vector{BBlock}
    argtypes::Vector{Any}
    sptypes::Vector{CC.VarState}
    linetable::Vector{Core.LineInfoNode}
    meta::Vector{Expr}
)</code></pre><p>A <code>BBCode</code> is a data structure which is similar to <code>IRCode</code>, but adds additional structure.</p><p>In particular, a <code>BBCode</code> comprises a sequence of basic blocks (<code>BBlock</code>s), each of which comprise a sequence of statements. Moreover, each <code>BBlock</code> has its own unique <code>ID</code>, as does each statment.</p><p>The consequence of this is that new basic blocks can be inserted into a <code>BBCode</code>. This is distinct from <code>IRCode</code>, in which to create a new basic block, one must insert additional statments which you know will create a new basic block – this is generally quite an unreliable process, while inserting a new <code>BBlock</code> into <code>BBCode</code> is entirely predictable. Furthermore, inserting a new <code>BBlock</code> does not change the <code>ID</code> associated to the other blocks, meaning that you can safely assume that references from existing basic block terminators / phi nodes to other blocks will not be modified by inserting a new basic block.</p><p>Additionally, since each statment in each basic block has its own unique <code>ID</code>, new statments can be inserted without changing references between other blocks. <code>IRCode</code> also has some support for this via its <code>new_nodes</code> field, but eventually all statements will be renamed upon <code>compact!</code>ing the <code>IRCode</code>, meaning that the name of any given statement will eventually change.</p><p>Finally, note that the basic blocks in a <code>BBCode</code> support the custom <code>Switch</code> statement. This statement is not valid in <code>IRCode</code>, and is therefore lowered into a collection of <code>GotoIfNot</code>s and <code>GotoNode</code>s when a <code>BBCode</code> is converted back into an <code>IRCode</code>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/compintell/Mooncake.jl/blob/9f19358ec93a14f67ccd63773de4a19f4c9f35fd/src/interpreter/bbcode.jl#L217-L249">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Mooncake.BBlock-Tuple{Mooncake.ID, Vector{Tuple{Mooncake.ID, Core.Compiler.NewInstruction}}}-developer_documentation-internal_docstrings" href="#Mooncake.BBlock-Tuple{Mooncake.ID, Vector{Tuple{Mooncake.ID, Core.Compiler.NewInstruction}}}-developer_documentation-internal_docstrings"><code>Mooncake.BBlock</code></a> — <span class="docstring-category">Method</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">BBlock(id::ID, inst_pairs::Vector{IDInstPair})</code></pre><p>Convenience constructor – splits <code>inst_pairs</code> into a <code>Vector{ID}</code> and <code>InstVector</code> in order to build a <code>BBlock</code>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/compintell/Mooncake.jl/blob/9f19358ec93a14f67ccd63773de4a19f4c9f35fd/src/interpreter/bbcode.jl#L151-L156">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Mooncake.BBlock-developer_documentation-internal_docstrings" href="#Mooncake.BBlock-developer_documentation-internal_docstrings"><code>Mooncake.BBlock</code></a> — <span class="docstring-category">Type</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">BBlock(id::ID, stmt_ids::Vector{ID}, stmts::InstVector)</code></pre><p>A basic block data structure (not called <code>BasicBlock</code> to avoid accidental confusion with <code>CC.BasicBlock</code>). Forms a single basic block.</p><p>Each <code>BBlock</code> has an <code>ID</code> (a unique name). This makes it possible to refer to blocks in a way that does not change when additional <code>BBlocks</code> are inserted into a <code>BBCode</code>. This differs from the positional block numbering found in <code>IRCode</code>, in which the number associated to a basic block changes when new blocks are inserted.</p><p>The <code>n</code>th line of code in a <code>BBlock</code> is associated to <code>ID</code> <code>stmt_ids[n]</code>, and the <code>n</code>th instruction from <code>stmts</code>.</p><p>Note that <code>PhiNode</code>s, <code>GotoIfNot</code>s, and <code>GotoNode</code>s should not appear in a <code>BBlock</code> – instead an <code>IDPhiNode</code>, <code>IDGotoIfNot</code>, or <code>IDGotoNode</code> should be used.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/compintell/Mooncake.jl/blob/9f19358ec93a14f67ccd63773de4a19f4c9f35fd/src/interpreter/bbcode.jl#L119-L135">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Mooncake.CannotProduceZeroRDataFromType-developer_documentation-internal_docstrings" href="#Mooncake.CannotProduceZeroRDataFromType-developer_documentation-internal_docstrings"><code>Mooncake.CannotProduceZeroRDataFromType</code></a> — <span class="docstring-category">Type</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">CannotProduceZeroRDataFromType()</code></pre><p>Returned by <code>zero_rdata_from_type</code> if is not possible to construct the zero rdata element for a given type. See <code>zero_rdata_from_type</code> for more info.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/compintell/Mooncake.jl/blob/9f19358ec93a14f67ccd63773de4a19f4c9f35fd/src/fwds_rvs_data.jl#L579-L584">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Mooncake.Config-developer_documentation-internal_docstrings" href="#Mooncake.Config-developer_documentation-internal_docstrings"><code>Mooncake.Config</code></a> — <span class="docstring-category">Type</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">Config(; debug_mode=false, silence_debug_messages=false)</code></pre><p>Configuration struct for use with ADTypes.AutoMooncake.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/compintell/Mooncake.jl/blob/9f19358ec93a14f67ccd63773de4a19f4c9f35fd/src/config.jl#L1-L5">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Mooncake.DebugPullback-Tuple{Any}-developer_documentation-internal_docstrings" href="#Mooncake.DebugPullback-Tuple{Any}-developer_documentation-internal_docstrings"><code>Mooncake.DebugPullback</code></a> — <span class="docstring-category">Method</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">(pb::DebugPullback)(dy)</code></pre><p>Apply type checking to enforce pre- and post-conditions on <code>pb.pb</code>. See the docstring for <code>DebugPullback</code> for details.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/compintell/Mooncake.jl/blob/9f19358ec93a14f67ccd63773de4a19f4c9f35fd/src/debug_mode.jl#L18-L23">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Mooncake.DebugPullback-developer_documentation-internal_docstrings" href="#Mooncake.DebugPullback-developer_documentation-internal_docstrings"><code>Mooncake.DebugPullback</code></a> — <span class="docstring-category">Type</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">DebugPullback(pb, y, x)</code></pre><p>Construct a callable which is equivalent to <code>pb</code>, but which enforces type-based pre- and post-conditions to <code>pb</code>. Let <code>dx = pb.pb(dy)</code>, for some rdata <code>dy</code>, then this function</p><ul><li>checks that <code>dy</code> has the correct rdata type for <code>y</code>, and</li><li>checks that each element of <code>dx</code> has the correct rdata type for <code>x</code>.</li></ul><p>Reverse pass counterpart to <a href="../../utilities/debug_mode/#Mooncake.DebugRRule"><code>DebugRRule</code></a></p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/compintell/Mooncake.jl/blob/9f19358ec93a14f67ccd63773de4a19f4c9f35fd/src/debug_mode.jl#L2-L11">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Mooncake.DebugRRule-Union{NTuple{N, Mooncake.CoDual}, Tuple{N}} where N-developer_documentation-internal_docstrings" href="#Mooncake.DebugRRule-Union{NTuple{N, Mooncake.CoDual}, Tuple{N}} where N-developer_documentation-internal_docstrings"><code>Mooncake.DebugRRule</code></a> — <span class="docstring-category">Method</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">(rule::DebugRRule)(x::CoDual...)</code></pre><p>Apply type checking to enforce pre- and post-conditions on <code>rule.rule</code>. See the docstring for <code>DebugRRule</code> for details.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/compintell/Mooncake.jl/blob/9f19358ec93a14f67ccd63773de4a19f4c9f35fd/src/debug_mode.jl#L81-L86">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Mooncake.DebugRRule-developer_documentation-internal_docstrings" href="#Mooncake.DebugRRule-developer_documentation-internal_docstrings"><code>Mooncake.DebugRRule</code></a> — <span class="docstring-category">Type</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">DebugRRule(rule)</code></pre><p>Construct a callable which is equivalent to <code>rule</code>, but inserts additional type checking. In particular:</p><ul><li>check that the fdata in each argument is of the correct type for the primal</li><li>check that the fdata in the <code>CoDual</code> returned from the rule is of the correct type for the   primal.</li></ul><p>This happens recursively. For example, each element of a <code>Vector{Any}</code> is compared against each element of the associated fdata to ensure that its type is correct, as this cannot be guaranteed from the static type alone.</p><p>Some additional dynamic checks are also performed (e.g. that an fdata array of the same size as its primal).</p><p>Let <code>rule</code> return <code>y, pb!!</code>, then <code>DebugRRule(rule)</code> returns <code>y, DebugPullback(pb!!)</code>. <code>DebugPullback</code> inserts the same kind of checks as <code>DebugRRule</code>, but on the reverse-pass. See the docstring for details.</p><p><em>Note:</em> at any given point in time, the checks performed by this function constitute a necessary but insufficient set of conditions to ensure correctness. If you find that an error isn&#39;t being caught by these tests, but you believe it ought to be, please open an issue or (better still) a PR.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/compintell/Mooncake.jl/blob/9f19358ec93a14f67ccd63773de4a19f4c9f35fd/src/debug_mode.jl#L49-L74">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Mooncake.DefaultCtx-developer_documentation-internal_docstrings" href="#Mooncake.DefaultCtx-developer_documentation-internal_docstrings"><code>Mooncake.DefaultCtx</code></a> — <span class="docstring-category">Type</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">struct DefaultCtx end</code></pre><p>Context for all usually used AD primitives. Anything which is a primitive in a MinimalCtx is a primitive in the DefaultCtx automatically. If you are adding a rule for the sake of performance, it should be a primitive in the DefaultCtx, but not the MinimalCtx.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/compintell/Mooncake.jl/blob/9f19358ec93a14f67ccd63773de4a19f4c9f35fd/src/interpreter/contexts.jl#L10-L16">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Mooncake.FData-developer_documentation-internal_docstrings" href="#Mooncake.FData-developer_documentation-internal_docstrings"><code>Mooncake.FData</code></a> — <span class="docstring-category">Type</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">FData(data::NamedTuple)</code></pre><p>The component of a <code>struct</code> which is propagated alongside the primal on the forwards-pass of AD. For example, the tangents for <code>Float64</code>s do not need to be propagated on the forwards- pass of reverse-mode AD, so any <code>Float64</code> fields of <code>Tangent</code> do not need to appear in the associated <code>FData</code>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/compintell/Mooncake.jl/blob/9f19358ec93a14f67ccd63773de4a19f4c9f35fd/src/fwds_rvs_data.jl#L13-L20">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Mooncake.ID-developer_documentation-internal_docstrings" href="#Mooncake.ID-developer_documentation-internal_docstrings"><code>Mooncake.ID</code></a> — <span class="docstring-category">Type</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">ID()</code></pre><p>An <code>ID</code> (read: unique name) is just a wrapper around an <code>Int32</code>. Uniqueness is ensured via a global counter, which is incremented each time that an <code>ID</code> is created.</p><p>This counter can be reset using <code>seed_id!</code> if you need to ensure deterministic <code>ID</code>s are produced, in the same way that seed for random number generators can be set.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/compintell/Mooncake.jl/blob/9f19358ec93a14f67ccd63773de4a19f4c9f35fd/src/interpreter/bbcode.jl#L5-L13">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Mooncake.IDGotoIfNot-developer_documentation-internal_docstrings" href="#Mooncake.IDGotoIfNot-developer_documentation-internal_docstrings"><code>Mooncake.IDGotoIfNot</code></a> — <span class="docstring-category">Type</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">IDGotoIfNot(cond::Any, dest::ID)</code></pre><p>Like a <code>GotoIfNot</code>, but <code>dest</code> is an <code>ID</code> rather than an <code>Int64</code>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/compintell/Mooncake.jl/blob/9f19358ec93a14f67ccd63773de4a19f4c9f35fd/src/interpreter/bbcode.jl#L61-L65">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Mooncake.IDGotoNode-developer_documentation-internal_docstrings" href="#Mooncake.IDGotoNode-developer_documentation-internal_docstrings"><code>Mooncake.IDGotoNode</code></a> — <span class="docstring-category">Type</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">IDGotoNode(label::ID)</code></pre><p>Like a <code>GotoNode</code>, but <code>label</code> is an <code>ID</code> rather than an <code>Int64</code>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/compintell/Mooncake.jl/blob/9f19358ec93a14f67ccd63773de4a19f4c9f35fd/src/interpreter/bbcode.jl#L50-L54">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Mooncake.IDInstPair-developer_documentation-internal_docstrings" href="#Mooncake.IDInstPair-developer_documentation-internal_docstrings"><code>Mooncake.IDInstPair</code></a> — <span class="docstring-category">Type</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">const IDInstPair = Tuple{ID, NewInstruction}</code></pre></div><a class="docs-sourcelink" target="_blank" href="https://github.com/compintell/Mooncake.jl/blob/9f19358ec93a14f67ccd63773de4a19f4c9f35fd/src/interpreter/bbcode.jl#L146-L148">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Mooncake.IDPhiNode-developer_documentation-internal_docstrings" href="#Mooncake.IDPhiNode-developer_documentation-internal_docstrings"><code>Mooncake.IDPhiNode</code></a> — <span class="docstring-category">Type</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">IDPhiNode(edges::Vector{ID}, values::Vector{Any})</code></pre><p>Like a <code>PhiNode</code>, but <code>edges</code> are <code>ID</code>s rather than <code>Int32</code>s.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/compintell/Mooncake.jl/blob/9f19358ec93a14f67ccd63773de4a19f4c9f35fd/src/interpreter/bbcode.jl#L38-L42">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Mooncake.InstVector-developer_documentation-internal_docstrings" href="#Mooncake.InstVector-developer_documentation-internal_docstrings"><code>Mooncake.InstVector</code></a> — <span class="docstring-category">Type</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">const InstVector = Vector{NewInstruction}</code></pre><p>Note: the <code>CC.NewInstruction</code> type is used to represent instructions because it has the correct fields. While it is only used to represent new instrucdtions in <code>Core.Compiler</code>, it is used to represent all instructions in <code>BBCode</code>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/compintell/Mooncake.jl/blob/9f19358ec93a14f67ccd63773de4a19f4c9f35fd/src/interpreter/bbcode.jl#L110-L116">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Mooncake.InvalidFDataException-developer_documentation-internal_docstrings" href="#Mooncake.InvalidFDataException-developer_documentation-internal_docstrings"><code>Mooncake.InvalidFDataException</code></a> — <span class="docstring-category">Type</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">InvalidFDataException(msg::String)</code></pre><p>Exception indicating that there is a problem with the fdata associated to a primal.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/compintell/Mooncake.jl/blob/9f19358ec93a14f67ccd63773de4a19f4c9f35fd/src/fwds_rvs_data.jl#L264-L268">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Mooncake.InvalidRDataException-developer_documentation-internal_docstrings" href="#Mooncake.InvalidRDataException-developer_documentation-internal_docstrings"><code>Mooncake.InvalidRDataException</code></a> — <span class="docstring-category">Type</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">InvalidRDataException(msg::String)</code></pre><p>Exception indicating that there is a problem with the rdata associated to a primal.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/compintell/Mooncake.jl/blob/9f19358ec93a14f67ccd63773de4a19f4c9f35fd/src/fwds_rvs_data.jl#L658-L662">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Mooncake.LazyZeroRData-developer_documentation-internal_docstrings" href="#Mooncake.LazyZeroRData-developer_documentation-internal_docstrings"><code>Mooncake.LazyZeroRData</code></a> — <span class="docstring-category">Type</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">LazyZeroRData{P, Tdata}()</code></pre><p>This type is a lazy placeholder for <code>zero_like_rdata_from_type</code>. This is used to defer construction of zero data to the reverse pass. Calling <code>instantiate</code> on an instance of this will construct a zero data.</p><p>Users should construct using <code>LazyZeroRData(p)</code>, where <code>p</code> is an value of type <code>P</code>. This constructor, and <code>instantiate</code>, are specialised to minimise the amount of data which must be stored. For example, <code>Float64</code>s do not need any data, so <code>LazyZeroRData(0.0)</code> produces an instance of a singleton type, meaning that various important optimisations can be performed in AD.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/compintell/Mooncake.jl/blob/9f19358ec93a14f67ccd63773de4a19f4c9f35fd/src/fwds_rvs_data.jl#L733-L745">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Mooncake.MinimalCtx-developer_documentation-internal_docstrings" href="#Mooncake.MinimalCtx-developer_documentation-internal_docstrings"><code>Mooncake.MinimalCtx</code></a> — <span class="docstring-category">Type</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">struct MinimalCtx end</code></pre><p>Functions should only be primitives in this context if not making them so would cause AD to fail. In particular, do not add primitives to this context if you are writing them for performance only – instead, make these primitives in the DefaultCtx.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/compintell/Mooncake.jl/blob/9f19358ec93a14f67ccd63773de4a19f4c9f35fd/src/interpreter/contexts.jl#L1-L7">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Mooncake.NoPullback-Union{NTuple{N, Mooncake.CoDual}, Tuple{N}} where N-developer_documentation-internal_docstrings" href="#Mooncake.NoPullback-Union{NTuple{N, Mooncake.CoDual}, Tuple{N}} where N-developer_documentation-internal_docstrings"><code>Mooncake.NoPullback</code></a> — <span class="docstring-category">Method</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">NoPullback(args::CoDual...)</code></pre><p>Construct a <code>NoPullback</code> from the arguments passed to an <code>rrule!!</code>. For each argument, extracts the primal value, and constructs a <code>LazyZeroRData</code>. These are stored in a <code>NoPullback</code> which, in the reverse-pass of AD, instantiates these <code>LazyZeroRData</code>s and returns them in order to perform the reverse-pass of AD.</p><p>The advantage of this approach is that if it is possible to construct the zero rdata element for each of the arguments lazily, the <code>NoPullback</code> generated will be a singleton type. This means that AD can avoid generating a stack to store this pullback, which can result in significant performance improvements.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/compintell/Mooncake.jl/blob/9f19358ec93a14f67ccd63773de4a19f4c9f35fd/src/codual.jl#L56-L68">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Mooncake.Stack-developer_documentation-internal_docstrings" href="#Mooncake.Stack-developer_documentation-internal_docstrings"><code>Mooncake.Stack</code></a> — <span class="docstring-category">Type</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">Stack{T}()</code></pre><p>A stack specialised for reverse-mode AD.</p><p>Semantically equivalent to a usual stack, but never de-allocates memory once allocated.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/compintell/Mooncake.jl/blob/9f19358ec93a14f67ccd63773de4a19f4c9f35fd/src/stack.jl#L1-L7">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Mooncake.Switch-developer_documentation-internal_docstrings" href="#Mooncake.Switch-developer_documentation-internal_docstrings"><code>Mooncake.Switch</code></a> — <span class="docstring-category">Type</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">Switch(conds::Vector{Any}, dests::Vector{ID}, fallthrough_dest::ID)</code></pre><p>A switch-statement node. These can be inserted in the <code>BBCode</code> representation of Julia IR. <code>Switch</code> has the following semantics:</p><pre><code class="language-julia hljs">goto dests[1] if not conds[1]
goto dests[2] if not conds[2]
...
goto dests[N] if not conds[N]
goto fallthrough_dest</code></pre><p>where the value associated to each element of <code>conds</code> is a <code>Bool</code>, and <code>dests</code> indicate which block to jump to. If none of the conditions are met, then we go to whichever block is specified by <code>fallthrough_dest</code>.</p><p><code>Switch</code> statements are lowered into the above sequence of <code>GotoIfNot</code>s and <code>GotoNode</code>s when converting <code>BBCode</code> back into <code>IRCode</code>, because <code>Switch</code> statements are not valid nodes in regular Julia IR.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/compintell/Mooncake.jl/blob/9f19358ec93a14f67ccd63773de4a19f4c9f35fd/src/interpreter/bbcode.jl#L73-L92">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Mooncake.UnhandledLanguageFeatureException-developer_documentation-internal_docstrings" href="#Mooncake.UnhandledLanguageFeatureException-developer_documentation-internal_docstrings"><code>Mooncake.UnhandledLanguageFeatureException</code></a> — <span class="docstring-category">Type</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">UnhandledLanguageFeatureException(message::String)</code></pre><p>An exception used to indicate that some aspect of the Julia language which AD cannot handle has been encountered.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/compintell/Mooncake.jl/blob/9f19358ec93a14f67ccd63773de4a19f4c9f35fd/src/interpreter/ir_utils.jl#L257-L262">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Mooncake.ZeroRData-developer_documentation-internal_docstrings" href="#Mooncake.ZeroRData-developer_documentation-internal_docstrings"><code>Mooncake.ZeroRData</code></a> — <span class="docstring-category">Type</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">ZeroRData()</code></pre><p>Singleton type indicating zero-valued rdata. This should only ever appear as an intermediate quantity in the reverse-pass of AD when the type of the primal is not fully inferable, or a field of a type is abstractly typed.</p><p>If you see this anywhere in actual code, or if it appears in a hand-written rule, this is an error – please open an issue in such a situation.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/compintell/Mooncake.jl/blob/9f19358ec93a14f67ccd63773de4a19f4c9f35fd/src/interpreter/zero_like_rdata.jl#L1-L10">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Base.insert!-Tuple{Mooncake.BBlock, Int64, Mooncake.ID, Core.Compiler.NewInstruction}-developer_documentation-internal_docstrings" href="#Base.insert!-Tuple{Mooncake.BBlock, Int64, Mooncake.ID, Core.Compiler.NewInstruction}-developer_documentation-internal_docstrings"><code>Base.insert!</code></a> — <span class="docstring-category">Method</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">Base.insert!(bb::BBlock, n::Int, id::ID, stmt::CC.NewInstruction)::Nothing</code></pre><p>Inserts <code>stmt</code> and <code>id</code> into <code>bb</code> immediately before the <code>n</code>th instruction.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/compintell/Mooncake.jl/blob/9f19358ec93a14f67ccd63773de4a19f4c9f35fd/src/interpreter/bbcode.jl#L179-L183">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Mooncake.__value_and_gradient!!-Union{Tuple{N}, Tuple{R}, Tuple{R, Vararg{Mooncake.CoDual, N}}} where {R, N}-developer_documentation-internal_docstrings" href="#Mooncake.__value_and_gradient!!-Union{Tuple{N}, Tuple{R}, Tuple{R, Vararg{Mooncake.CoDual, N}}} where {R, N}-developer_documentation-internal_docstrings"><code>Mooncake.__value_and_gradient!!</code></a> — <span class="docstring-category">Method</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">__value_and_gradient!!(rule, f::CoDual, x::CoDual...)</code></pre><p><em>Note:</em> this is not part of the public Mooncake.jl interface, and may change without warning.</p><p>Equivalent to <code>__value_and_pullback!!(rule, 1.0, f, x...)</code> – assumes <code>f</code> returns a <code>Float64</code>.</p><pre><code class="language-julia hljs"># Set up the problem.
f(x, y) = sum(x .* y)
x = [2.0, 2.0]
y = [1.0, 1.0]
rule = build_rrule(f, x, y)

# Allocate tangents. These will be written to in-place. You are free to re-use these if you
# compute gradients multiple times.
tf = zero_tangent(f)
tx = zero_tangent(x)
ty = zero_tangent(y)

# Do AD.
Mooncake.__value_and_gradient!!(
    rule, Mooncake.CoDual(f, tf), Mooncake.CoDual(x, tx), Mooncake.CoDual(y, ty)
)
# output

(4.0, (NoTangent(), [1.0, 1.0], [2.0, 2.0]))</code></pre></div><a class="docs-sourcelink" target="_blank" href="https://github.com/compintell/Mooncake.jl/blob/9f19358ec93a14f67ccd63773de4a19f4c9f35fd/src/interface.jl#L41-L69">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Mooncake.__value_and_pullback!!-Union{Tuple{T}, Tuple{N}, Tuple{R}, Tuple{R, T, Vararg{Mooncake.CoDual, N}}} where {R, N, T}-developer_documentation-internal_docstrings" href="#Mooncake.__value_and_pullback!!-Union{Tuple{T}, Tuple{N}, Tuple{R}, Tuple{R, T, Vararg{Mooncake.CoDual, N}}} where {R, N, T}-developer_documentation-internal_docstrings"><code>Mooncake.__value_and_pullback!!</code></a> — <span class="docstring-category">Method</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">__value_and_pullback!!(rule, ȳ, f::CoDual, x::CoDual...)</code></pre><p><em>Note:</em> this is not part of the public Mooncake.jl interface, and may change without warning.</p><p>In-place version of <code>value_and_pullback!!</code> in which the arguments have been wrapped in <code>CoDual</code>s. Note that any mutable data in <code>f</code> and <code>x</code> will be incremented in-place. As such, if calling this function multiple times with different values of <code>x</code>, should be careful to ensure that you zero-out the tangent fields of <code>x</code> each time.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/compintell/Mooncake.jl/blob/9f19358ec93a14f67ccd63773de4a19f4c9f35fd/src/interface.jl#L1-L10">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Mooncake._build_graph_of_cfg-Tuple{Vector{Mooncake.BBlock}}-developer_documentation-internal_docstrings" href="#Mooncake._build_graph_of_cfg-Tuple{Vector{Mooncake.BBlock}}-developer_documentation-internal_docstrings"><code>Mooncake._build_graph_of_cfg</code></a> — <span class="docstring-category">Method</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">_build_graph_of_cfg(blks::Vector{BBlock})::Tuple{SimpleDiGraph, Dict{ID, Int}}</code></pre><p>Builds a <code>SimpleDiGraph</code>, <code>g</code>, representing of the CFG associated to <code>blks</code>, where <code>blks</code> comprises the collection of basic blocks associated to a <code>BBCode</code>. This is a type from Graphs.jl, so constructing <code>g</code> makes it straightforward to analyse the control flow structure of <code>ir</code> using algorithms from Graphs.jl.</p><p>Returns a 2-tuple, whose first element is <code>g</code>, and whose second element is a map from the <code>ID</code> associated to each basic block in <code>ir</code>, to the <code>Int</code> corresponding to its node index in <code>g</code>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/compintell/Mooncake.jl/blob/9f19358ec93a14f67ccd63773de4a19f4c9f35fd/src/interpreter/bbcode.jl#L632-L643">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Mooncake._compute_all_predecessors-Tuple{Vector{Mooncake.BBlock}}-developer_documentation-internal_docstrings" href="#Mooncake._compute_all_predecessors-Tuple{Vector{Mooncake.BBlock}}-developer_documentation-internal_docstrings"><code>Mooncake._compute_all_predecessors</code></a> — <span class="docstring-category">Method</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">_compute_all_predecessors(blks::Vector{BBlock})::Dict{ID, Vector{ID}}</code></pre><p>Internal method implementing <a href="#Mooncake.compute_all_predecessors-Tuple{Mooncake.BBCode}-developer_documentation-internal_docstrings"><code>compute_all_predecessors</code></a>. This method is easier to construct test cases for because it only requires the collection of <code>BBlocks</code>, not all of the other stuff that goes into a <code>BBCode</code>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/compintell/Mooncake.jl/blob/9f19358ec93a14f67ccd63773de4a19f4c9f35fd/src/interpreter/bbcode.jl#L319-L325">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Mooncake._compute_all_successors-Tuple{Vector{Mooncake.BBlock}}-developer_documentation-internal_docstrings" href="#Mooncake._compute_all_successors-Tuple{Vector{Mooncake.BBlock}}-developer_documentation-internal_docstrings"><code>Mooncake._compute_all_successors</code></a> — <span class="docstring-category">Method</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">_compute_all_successors(blks::Vector{BBlock})::Dict{ID, Vector{ID}}</code></pre><p>Internal method implementing <a href="#Mooncake.compute_all_successors-Tuple{Mooncake.BBCode}-developer_documentation-internal_docstrings"><code>compute_all_successors</code></a>. Just requires that a Vector of BBlocks are passed. This method is easier to construct test cases for because there is no need to construct all the other stuff that goes into a <code>BBCode</code>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/compintell/Mooncake.jl/blob/9f19358ec93a14f67ccd63773de4a19f4c9f35fd/src/interpreter/bbcode.jl#L286-L292">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Mooncake._distance_to_entry-Tuple{Vector{Mooncake.BBlock}}-developer_documentation-internal_docstrings" href="#Mooncake._distance_to_entry-Tuple{Vector{Mooncake.BBlock}}-developer_documentation-internal_docstrings"><code>Mooncake._distance_to_entry</code></a> — <span class="docstring-category">Method</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">_distance_to_entry(blks::Vector{BBlock})::Vector{Int}</code></pre><p>For each basic block in <code>blks</code>, compute the distance from it to the entry point (the first block. The distance is <code>typemax(Int)</code> if no path from the entry point to a given node.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/compintell/Mooncake.jl/blob/9f19358ec93a14f67ccd63773de4a19f4c9f35fd/src/interpreter/bbcode.jl#L655-L660">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Mooncake._foreigncall_-Union{Tuple{N}, Tuple{calling_convention}, Tuple{nreq}, Tuple{RT}, Tuple{name}, Tuple{Val{name}, Val{RT}, Tuple, Val{nreq}, Val{calling_convention}, Vararg{Any, N}}} where {name, RT, nreq, calling_convention, N}-developer_documentation-internal_docstrings" href="#Mooncake._foreigncall_-Union{Tuple{N}, Tuple{calling_convention}, Tuple{nreq}, Tuple{RT}, Tuple{name}, Tuple{Val{name}, Val{RT}, Tuple, Val{nreq}, Val{calling_convention}, Vararg{Any, N}}} where {name, RT, nreq, calling_convention, N}-developer_documentation-internal_docstrings"><code>Mooncake._foreigncall_</code></a> — <span class="docstring-category">Method</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">function _foreigncall_(
    ::Val{name}, ::Val{RT}, AT::Tuple, ::Val{nreq}, ::Val{calling_convention}, x...
) where {name, RT, nreq, calling_convention}</code></pre><p>:foreigncall nodes get translated into calls to this function. For example,</p><pre><code class="language-julia hljs">Expr(:foreigncall, :foo, Tout, (A, B), nreq, :ccall, args...)</code></pre><p>becomes</p><pre><code class="language-julia hljs">_foreigncall_(Val(:foo), Val(Tout), (Val(A), Val(B)), Val(nreq), Val(:ccall), args...)</code></pre><p>Please consult the Julia documentation for more information on how foreigncall nodes work, and consult this package&#39;s tests for examples.</p><p>Credit: Umlaut.jl has the original implementation of this function. This is largely copied over from there.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/compintell/Mooncake.jl/blob/9f19358ec93a14f67ccd63773de4a19f4c9f35fd/src/rrules/foreigncall.jl#L28-L47">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Mooncake._is_reachable-Tuple{Vector{Mooncake.BBlock}}-developer_documentation-internal_docstrings" href="#Mooncake._is_reachable-Tuple{Vector{Mooncake.BBlock}}-developer_documentation-internal_docstrings"><code>Mooncake._is_reachable</code></a> — <span class="docstring-category">Method</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">_is_reachable(blks::Vector{BBlock})::Vector{Bool}</code></pre><p>Computes a <code>Vector</code> whose length is <code>length(blks)</code>. The <code>n</code>th element is <code>true</code> iff it is possible for control flow to reach the <code>n</code>th block.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/compintell/Mooncake.jl/blob/9f19358ec93a14f67ccd63773de4a19f4c9f35fd/src/interpreter/bbcode.jl#L806-L811">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Mooncake._new_-Union{Tuple{N}, Tuple{T}, Tuple{Type{T}, Vararg{Any, N}}} where {T, N}-developer_documentation-internal_docstrings" href="#Mooncake._new_-Union{Tuple{N}, Tuple{T}, Tuple{Type{T}, Vararg{Any, N}}} where {T, N}-developer_documentation-internal_docstrings"><code>Mooncake._new_</code></a> — <span class="docstring-category">Method</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">_new_(::Type{T}, x::Vararg{Any, N}) where {T, N}</code></pre><p>One-liner which calls the <code>:new</code> instruction with type <code>T</code> with arguments <code>x</code>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/compintell/Mooncake.jl/blob/9f19358ec93a14f67ccd63773de4a19f4c9f35fd/src/utils.jl#L210-L214">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Mooncake._splat_new_-Union{Tuple{P}, Tuple{Type{P}, Tuple}} where P-developer_documentation-internal_docstrings" href="#Mooncake._splat_new_-Union{Tuple{P}, Tuple{Type{P}, Tuple}} where P-developer_documentation-internal_docstrings"><code>Mooncake._splat_new_</code></a> — <span class="docstring-category">Method</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">_splat_new_(::Type{P}, x::Tuple) where {P}</code></pre><p>Function which replaces instances of <code>:splatnew</code>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/compintell/Mooncake.jl/blob/9f19358ec93a14f67ccd63773de4a19f4c9f35fd/src/rrules/new.jl#L57-L61">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Mooncake._typeof-Tuple{Any}-developer_documentation-internal_docstrings" href="#Mooncake._typeof-Tuple{Any}-developer_documentation-internal_docstrings"><code>Mooncake._typeof</code></a> — <span class="docstring-category">Method</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">_typeof(x)</code></pre><p>Central definition of typeof, which is specific to the use-required in this package.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/compintell/Mooncake.jl/blob/9f19358ec93a14f67ccd63773de4a19f4c9f35fd/src/utils.jl#L1-L5">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Mooncake.can_produce_zero_rdata_from_type-Union{Tuple{Type{P}}, Tuple{P}} where P-developer_documentation-internal_docstrings" href="#Mooncake.can_produce_zero_rdata_from_type-Union{Tuple{Type{P}}, Tuple{P}} where P-developer_documentation-internal_docstrings"><code>Mooncake.can_produce_zero_rdata_from_type</code></a> — <span class="docstring-category">Method</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">can_produce_zero_rdata_from_type(::Type{P}) where {P}</code></pre><p>Returns whether or not the zero element of the rdata type for primal type <code>P</code> can be obtained from <code>P</code> alone.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/compintell/Mooncake.jl/blob/9f19358ec93a14f67ccd63773de4a19f4c9f35fd/src/fwds_rvs_data.jl#L555-L560">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Mooncake.characterise_used_ids-Tuple{Vector{Tuple{Mooncake.ID, Core.Compiler.NewInstruction}}}-developer_documentation-internal_docstrings" href="#Mooncake.characterise_used_ids-Tuple{Vector{Tuple{Mooncake.ID, Core.Compiler.NewInstruction}}}-developer_documentation-internal_docstrings"><code>Mooncake.characterise_used_ids</code></a> — <span class="docstring-category">Method</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">characterise_used_ids(stmts::Vector{IDInstPair})::Dict{ID, Bool}</code></pre><p>For each line in <code>stmts</code>, determine whether it is referenced anywhere else in the code. Returns a dictionary containing the results. An element is <code>false</code> if the corresponding <code>ID</code> is unused, and <code>true</code> if is used.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/compintell/Mooncake.jl/blob/9f19358ec93a14f67ccd63773de4a19f4c9f35fd/src/interpreter/bbcode.jl#L759-L765">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Mooncake.collect_stmts-Tuple{Mooncake.BBCode}-developer_documentation-internal_docstrings" href="#Mooncake.collect_stmts-Tuple{Mooncake.BBCode}-developer_documentation-internal_docstrings"><code>Mooncake.collect_stmts</code></a> — <span class="docstring-category">Method</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">collect_stmts(ir::BBCode)::Vector{IDInstPair}</code></pre><p>Produce a <code>Vector</code> containing all of the statements in <code>ir</code>. These are returned in order, so it is safe to assume that element <code>n</code> refers to the <code>nth</code> element of the <code>IRCode</code> associated to <code>ir</code>. </p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/compintell/Mooncake.jl/blob/9f19358ec93a14f67ccd63773de4a19f4c9f35fd/src/interpreter/bbcode.jl#L344-L350">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Mooncake.collect_stmts-Tuple{Mooncake.BBlock}-developer_documentation-internal_docstrings" href="#Mooncake.collect_stmts-Tuple{Mooncake.BBlock}-developer_documentation-internal_docstrings"><code>Mooncake.collect_stmts</code></a> — <span class="docstring-category">Method</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">collect_stmts(bb::BBlock)::Vector{IDInstPair}</code></pre><p>Returns a <code>Vector</code> containing the <code>ID</code>s and instructions associated to each line in <code>bb</code>. These should be assumed to be ordered.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/compintell/Mooncake.jl/blob/9f19358ec93a14f67ccd63773de4a19f4c9f35fd/src/interpreter/bbcode.jl#L209-L214">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Mooncake.compute_all_predecessors-Tuple{Mooncake.BBCode}-developer_documentation-internal_docstrings" href="#Mooncake.compute_all_predecessors-Tuple{Mooncake.BBCode}-developer_documentation-internal_docstrings"><code>Mooncake.compute_all_predecessors</code></a> — <span class="docstring-category">Method</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">compute_all_predecessors(ir::BBCode)::Dict{ID, Vector{ID}}</code></pre><p>Compute a map from the <code>ID of each</code>BBlock<code>in</code>ir` to its possible predecessors.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/compintell/Mooncake.jl/blob/9f19358ec93a14f67ccd63773de4a19f4c9f35fd/src/interpreter/bbcode.jl#L310-L314">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Mooncake.compute_all_successors-Tuple{Mooncake.BBCode}-developer_documentation-internal_docstrings" href="#Mooncake.compute_all_successors-Tuple{Mooncake.BBCode}-developer_documentation-internal_docstrings"><code>Mooncake.compute_all_successors</code></a> — <span class="docstring-category">Method</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">compute_all_successors(ir::BBCode)::Dict{ID, Vector{ID}}</code></pre><p>Compute a map from the <code>ID of each</code>BBlock<code>in</code>ir` to its possible successors.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/compintell/Mooncake.jl/blob/9f19358ec93a14f67ccd63773de4a19f4c9f35fd/src/interpreter/bbcode.jl#L277-L281">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Mooncake.control_flow_graph-Tuple{Mooncake.BBCode}-developer_documentation-internal_docstrings" href="#Mooncake.control_flow_graph-Tuple{Mooncake.BBCode}-developer_documentation-internal_docstrings"><code>Mooncake.control_flow_graph</code></a> — <span class="docstring-category">Method</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">control_flow_graph(bb_code::BBCode)::Core.Compiler.CFG</code></pre><p>Computes the <code>Core.Compiler.CFG</code> object associated to this <code>bb_code</code>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/compintell/Mooncake.jl/blob/9f19358ec93a14f67ccd63773de4a19f4c9f35fd/src/interpreter/bbcode.jl#L370-L374">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Mooncake.fcodual_type-Union{Tuple{Type{P}}, Tuple{P}} where P-developer_documentation-internal_docstrings" href="#Mooncake.fcodual_type-Union{Tuple{Type{P}}, Tuple{P}} where P-developer_documentation-internal_docstrings"><code>Mooncake.fcodual_type</code></a> — <span class="docstring-category">Method</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">fcodual_type(P::Type)</code></pre><p>The type of the <code>CoDual</code> which contains instances of <code>P</code> and its fdata.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/compintell/Mooncake.jl/blob/9f19358ec93a14f67ccd63773de4a19f4c9f35fd/src/codual.jl#L89-L93">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Mooncake.fdata_field_type-Union{Tuple{P}, Tuple{Type{P}, Int64}} where P-developer_documentation-internal_docstrings" href="#Mooncake.fdata_field_type-Union{Tuple{P}, Tuple{Type{P}, Int64}} where P-developer_documentation-internal_docstrings"><code>Mooncake.fdata_field_type</code></a> — <span class="docstring-category">Method</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">fdata_field_type(::Type{P}, n::Int) where {P}</code></pre><p>Returns the type of to the nth field of the fdata type associated to <code>P</code>. Will be a <code>PossiblyUninitTangent</code> if said field can be undefined.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/compintell/Mooncake.jl/blob/9f19358ec93a14f67ccd63773de4a19f4c9f35fd/src/fwds_rvs_data.jl#L219-L224">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Mooncake.foreigncall_to_call-Tuple{Any, Dict{Symbol, Core.Compiler.VarState}}-developer_documentation-internal_docstrings" href="#Mooncake.foreigncall_to_call-Tuple{Any, Dict{Symbol, Core.Compiler.VarState}}-developer_documentation-internal_docstrings"><code>Mooncake.foreigncall_to_call</code></a> — <span class="docstring-category">Method</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">foreigncall_to_call(inst, sp_map::Dict{Symbol, CC.VarState})</code></pre><p>If <code>inst</code> is a <code>:foreigncall</code> expression translate it into an equivalent <code>:call</code> expression. If anything else, just return <code>inst</code>. See <code>Mooncake._foreigncall_</code> for details.</p><p><code>sp_map</code> maps the names of the static parameters to their values. This function is intended to be called in the context of an <code>IRCode</code>, in which case the values of <code>sp_map</code> are given by the <code>sptypes</code> field of said <code>IRCode</code>. The keys should generally be obtained from the <code>Method</code> from which the <code>IRCode</code> is derived. See <code>Mooncake.normalise!</code> for more details.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/compintell/Mooncake.jl/blob/9f19358ec93a14f67ccd63773de4a19f4c9f35fd/src/interpreter/ir_normalisation.jl#L67-L77">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Mooncake.fwd_ir-Tuple{Type{&lt;:Tuple}}-developer_documentation-internal_docstrings" href="#Mooncake.fwd_ir-Tuple{Type{&lt;:Tuple}}-developer_documentation-internal_docstrings"><code>Mooncake.fwd_ir</code></a> — <span class="docstring-category">Method</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">fwd_ir(
    sig::Type{&lt;:Tuple};
    interp=get_interpreter(), debug_mode::Bool=false, do_inline::Bool=true
)::IRCode</code></pre><p>!!! warning: this is not part of the public interface of Mooncake. As such, it may change as part of a non-breaking release of the package.</p><p>Generate the <code>Core.Compiler.IRCode</code> used to construct the forwards-pass of AD. Take a look at how <code>build_rrule</code> makes use of <code>generate_ir</code> to see exactly how this is used in practice.</p><p>For example, if you wanted to get the IR associated to the forwards pass for the call <code>map(sin, randn(10))</code>, you could do either of the following:</p><pre><code class="language-julia-repl hljs">julia&gt; Mooncake.fwd_ir(Tuple{typeof(map), typeof(sin), Vector{Float64}}) isa Core.Compiler.IRCode
true
julia&gt; Mooncake.fwd_ir(typeof((map, sin, randn(10)))) isa Core.Compiler.IRCode
true</code></pre><p><strong>Arguments</strong></p><ul><li><code>sig::Type{&lt;:Tuple}</code>: the signature of the call to be differentiated.</li></ul><p><strong>Keyword Arguments</strong></p><ul><li><code>interp</code>: the interpreter to use to obtain the primal IR.</li><li><code>debug_mode::Bool</code>: whether the generated IR should make use of Mooncake&#39;s debug mode.</li><li><code>do_inline::Bool</code>: whether to apply an inlining pass prior to returning the ir generated   by this function. This is <code>true</code> by default, but setting it to <code>false</code> can sometimes be   helpful if you need to understand what function calls are generated in order to perform   AD, before lots of it gets inlined away.</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/compintell/Mooncake.jl/blob/9f19358ec93a14f67ccd63773de4a19f4c9f35fd/src/developer_tools.jl#L23-L54">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Mooncake.gc_preserve-Tuple-developer_documentation-internal_docstrings" href="#Mooncake.gc_preserve-Tuple-developer_documentation-internal_docstrings"><code>Mooncake.gc_preserve</code></a> — <span class="docstring-category">Method</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">gc_preserve(xs...)</code></pre><p>A no-op function. Its <code>rrule!!</code> ensures that the memory associated to <code>xs</code> is not freed until the pullback that it returns is run.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/compintell/Mooncake.jl/blob/9f19358ec93a14f67ccd63773de4a19f4c9f35fd/src/interpreter/ir_normalisation.jl#L257-L262">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Mooncake.get_tangent_field-Union{Tuple{Tfs}, Tuple{Union{MutableTangent{Tfs}, Tangent{Tfs}}, Int64}} where Tfs-developer_documentation-internal_docstrings" href="#Mooncake.get_tangent_field-Union{Tuple{Tfs}, Tuple{Union{MutableTangent{Tfs}, Tangent{Tfs}}, Int64}} where Tfs-developer_documentation-internal_docstrings"><code>Mooncake.get_tangent_field</code></a> — <span class="docstring-category">Method</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">get_tangent_field(t::Union{MutableTangent, Tangent}, i::Int)</code></pre><p>Gets the <code>i</code>th field of data in <code>t</code>.</p><p>Has the same semantics that <code>getfield!</code> would have if the data in the <code>fields</code> field of <code>t</code> were actually fields of <code>t</code>. This is the moral equivalent of <code>getfield</code> for <code>MutableTangent</code>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/compintell/Mooncake.jl/blob/9f19358ec93a14f67ccd63773de4a19f4c9f35fd/src/tangents.jl#L73-L81">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Mooncake.id_to_line_map-Tuple{Mooncake.BBCode}-developer_documentation-internal_docstrings" href="#Mooncake.id_to_line_map-Tuple{Mooncake.BBCode}-developer_documentation-internal_docstrings"><code>Mooncake.id_to_line_map</code></a> — <span class="docstring-category">Method</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">id_to_line_map(ir::BBCode)</code></pre><p>Produces a <code>Dict</code> mapping from each <code>ID</code> associated with a line in <code>ir</code> to its line number. This is isomorphic to mapping to its <code>SSAValue</code> in <code>IRCode</code>. Terminators do not have <code>ID</code>s associated to them, so not every line in the original <code>IRCode</code> is mapped to.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/compintell/Mooncake.jl/blob/9f19358ec93a14f67ccd63773de4a19f4c9f35fd/src/interpreter/bbcode.jl#L353-L359">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Mooncake.inc_args-Tuple{Expr}-developer_documentation-internal_docstrings" href="#Mooncake.inc_args-Tuple{Expr}-developer_documentation-internal_docstrings"><code>Mooncake.inc_args</code></a> — <span class="docstring-category">Method</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">inc_args(stmt)</code></pre><p>Increment by <code>1</code> the <code>n</code> field of any <code>Argument</code>s present in <code>stmt</code>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/compintell/Mooncake.jl/blob/9f19358ec93a14f67ccd63773de4a19f4c9f35fd/src/interpreter/ir_utils.jl#L274-L278">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Mooncake.increment_and_get_rdata!-Union{Tuple{T}, Tuple{NoFData, T, T}} where T&lt;:Union{Float16, Float32, Float64}-developer_documentation-internal_docstrings" href="#Mooncake.increment_and_get_rdata!-Union{Tuple{T}, Tuple{NoFData, T, T}} where T&lt;:Union{Float16, Float32, Float64}-developer_documentation-internal_docstrings"><code>Mooncake.increment_and_get_rdata!</code></a> — <span class="docstring-category">Method</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">increment_and_get_rdata!(fdata, zero_rdata, cr_tangent)</code></pre><p>Increment <code>fdata</code> by the fdata component of the ChainRules.jl-style tangent, <code>cr_tangent</code>, and return the rdata component of <code>cr_tangent</code> by adding it to <code>zero_rdata</code>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/compintell/Mooncake.jl/blob/9f19358ec93a14f67ccd63773de4a19f4c9f35fd/src/tools_for_rules.jl#L243-L248">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Mooncake.increment_field!!-Union{Tuple{i}, Tuple{Tuple, Any, Val{i}}} where i-developer_documentation-internal_docstrings" href="#Mooncake.increment_field!!-Union{Tuple{i}, Tuple{Tuple, Any, Val{i}}} where i-developer_documentation-internal_docstrings"><code>Mooncake.increment_field!!</code></a> — <span class="docstring-category">Method</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">increment_field!!(x::T, y::V, f) where {T, V}</code></pre><p><code>increment!!</code> the field <code>f</code> of <code>x</code> by <code>y</code>, and return the updated <code>x</code>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/compintell/Mooncake.jl/blob/9f19358ec93a14f67ccd63773de4a19f4c9f35fd/src/tangents.jl#L763-L767">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Mooncake.increment_rdata!!-Union{Tuple{T}, Tuple{T, Any}} where T-developer_documentation-internal_docstrings" href="#Mooncake.increment_rdata!!-Union{Tuple{T}, Tuple{T, Any}} where T-developer_documentation-internal_docstrings"><code>Mooncake.increment_rdata!!</code></a> — <span class="docstring-category">Method</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">increment_rdata!!(t::T, r)::T where {T}</code></pre><p>Increment the rdata component of tangent <code>t</code> by <code>r</code>, and return the updated tangent. Useful for implementation getfield-like rules for mutable structs, pointers, dicts, etc.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/compintell/Mooncake.jl/blob/9f19358ec93a14f67ccd63773de4a19f4c9f35fd/src/fwds_rvs_data.jl#L895-L900">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Mooncake.infer_ir!-Tuple{Core.Compiler.IRCode}-developer_documentation-internal_docstrings" href="#Mooncake.infer_ir!-Tuple{Core.Compiler.IRCode}-developer_documentation-internal_docstrings"><code>Mooncake.infer_ir!</code></a> — <span class="docstring-category">Method</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">infer_ir!(ir::IRCode) -&gt; IRCode</code></pre><p>Runs type inference on <code>ir</code>, which mutates <code>ir</code>, and returns it.</p><p>Note: the compiler will not infer the types of anything where the corrsponding element of <code>ir.stmts.flag</code> is not set to <code>Core.Compiler.IR_FLAG_REFINED</code>. Nor will it attempt to refine the type of the value returned by a <code>:invoke</code> expressions. Consequently, if you find that the types in your IR are not being refined, you may wish to check that neither of these things are happening.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/compintell/Mooncake.jl/blob/9f19358ec93a14f67ccd63773de4a19f4c9f35fd/src/interpreter/ir_utils.jl#L83-L93">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Mooncake.insert_before_terminator!-Tuple{Mooncake.BBlock, Mooncake.ID, Core.Compiler.NewInstruction}-developer_documentation-internal_docstrings" href="#Mooncake.insert_before_terminator!-Tuple{Mooncake.BBlock, Mooncake.ID, Core.Compiler.NewInstruction}-developer_documentation-internal_docstrings"><code>Mooncake.insert_before_terminator!</code></a> — <span class="docstring-category">Method</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">insert_before_terminator!(bb::BBlock, id::ID, inst::NewInstruction)::Nothing</code></pre><p>If the final instruction in <code>bb</code> is a <code>Terminator</code>, insert <code>inst</code> immediately before it. Otherwise, insert <code>inst</code> at the end of the block.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/compintell/Mooncake.jl/blob/9f19358ec93a14f67ccd63773de4a19f4c9f35fd/src/interpreter/bbcode.jl#L198-L203">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Mooncake.interpolate_boundschecks!-Tuple{Core.Compiler.IRCode}-developer_documentation-internal_docstrings" href="#Mooncake.interpolate_boundschecks!-Tuple{Core.Compiler.IRCode}-developer_documentation-internal_docstrings"><code>Mooncake.interpolate_boundschecks!</code></a> — <span class="docstring-category">Method</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">interpolate_boundschecks!(ir::IRCode)</code></pre><p>For every <code>x = Expr(:boundscheck, value)</code> in <code>ir</code>, interpolate <code>value</code> into all uses of <code>x</code>. This is only required in order to ensure that literal versions of memoryrefget, memoryrefset!, getfield, and setfield! work effectively. If they are removed through improvements to the way that we handle constant propagation inside Mooncake, then this functionality can be removed.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/compintell/Mooncake.jl/blob/9f19358ec93a14f67ccd63773de4a19f4c9f35fd/src/interpreter/ir_normalisation.jl#L39-L47">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Mooncake.intrinsic_to_function-Tuple{Any}-developer_documentation-internal_docstrings" href="#Mooncake.intrinsic_to_function-Tuple{Any}-developer_documentation-internal_docstrings"><code>Mooncake.intrinsic_to_function</code></a> — <span class="docstring-category">Method</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">intrinsic_to_function(inst)</code></pre><p>If <code>inst</code> is a <code>:call</code> expression to a <code>Core.IntrinsicFunction</code>, replace it with a call to the corresponding <code>function</code> from <code>Mooncake.IntrinsicsWrappers</code>, else return <code>inst</code>.</p><p><code>cglobal</code> is a special case – it requires that its first argument be static in exactly the same way as <code>:foreigncall</code>. See <code>IntrinsicsWrappers.__cglobal</code> for more info.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/compintell/Mooncake.jl/blob/9f19358ec93a14f67ccd63773de4a19f4c9f35fd/src/interpreter/ir_normalisation.jl#L159-L167">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Mooncake.ircode-developer_documentation-internal_docstrings" href="#Mooncake.ircode-developer_documentation-internal_docstrings"><code>Mooncake.ircode</code></a> — <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">ircode(
    inst::Vector{Any},
    argtypes::Vector{Any},
    sptypes::Vector{CC.VarState}=CC.VarState[],
) -&gt; IRCode</code></pre><p>Constructs an instance of an <code>IRCode</code>. This is useful for constructing test cases with known properties.</p><p>No optimisations or type inference are performed on the resulting <code>IRCode</code>, so that the <code>IRCode</code> contains exactly what is intended by the caller. Please make use of <code>infer_types!</code> if you require the types to be inferred.</p><p>Edges in <code>PhiNode</code>s, <code>GotoIfNot</code>s, and <code>GotoNode</code>s found in <code>inst</code> must refer to lines (as in <code>CodeInfo</code>). In the <code>IRCode</code> returned by this function, these line references are translated into block references.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/compintell/Mooncake.jl/blob/9f19358ec93a14f67ccd63773de4a19f4c9f35fd/src/interpreter/ir_utils.jl#L4-L21">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Mooncake.is_always_fully_initialised-Tuple{DataType}-developer_documentation-internal_docstrings" href="#Mooncake.is_always_fully_initialised-Tuple{DataType}-developer_documentation-internal_docstrings"><code>Mooncake.is_always_fully_initialised</code></a> — <span class="docstring-category">Method</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">is_always_fully_initialised(P::DataType)::Bool</code></pre><p>True if all fields in <code>P</code> are always initialised. Put differently, there are no inner constructors which permit partial initialisation.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/compintell/Mooncake.jl/blob/9f19358ec93a14f67ccd63773de4a19f4c9f35fd/src/utils.jl#L182-L187">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Mooncake.is_always_initialised-Tuple{DataType, Int64}-developer_documentation-internal_docstrings" href="#Mooncake.is_always_initialised-Tuple{DataType, Int64}-developer_documentation-internal_docstrings"><code>Mooncake.is_always_initialised</code></a> — <span class="docstring-category">Method</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">is_always_initialised(P::DataType, n::Int)::Bool</code></pre><p>True if the <code>n</code>th field of <code>P</code> is always initialised. If the <code>n</code>th fieldtype of <code>P</code> <code>isbitstype</code>, then this is distinct from asking whether the <code>n</code>th field is always defined. An isbits field is always defined, but is not always explicitly initialised.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/compintell/Mooncake.jl/blob/9f19358ec93a14f67ccd63773de4a19f4c9f35fd/src/utils.jl#L171-L177">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Mooncake.is_primitive-Tuple{Type{Mooncake.MinimalCtx}, Any}-developer_documentation-internal_docstrings" href="#Mooncake.is_primitive-Tuple{Type{Mooncake.MinimalCtx}, Any}-developer_documentation-internal_docstrings"><code>Mooncake.is_primitive</code></a> — <span class="docstring-category">Method</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">is_primitive(::Type{Ctx}, sig) where {Ctx}</code></pre><p>Returns a <code>Bool</code> specifying whether the methods specified by <code>sig</code> are considered primitives in the context of contexts of type <code>Ctx</code>.</p><pre><code class="language-julia hljs">is_primitive(DefaultCtx, Tuple{typeof(sin), Float64})</code></pre><p>will return if calling <code>sin(5.0)</code> should be treated as primitive when the context is a <code>DefaultCtx</code>.</p><p>Observe that this information means that whether or not something is a primitive in a particular context depends only on static information, not any run-time information that might live in a particular instance of <code>Ctx</code>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/compintell/Mooncake.jl/blob/9f19358ec93a14f67ccd63773de4a19f4c9f35fd/src/interpreter/contexts.jl#L19-L34">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Mooncake.is_reachable_return_node-Tuple{Core.ReturnNode}-developer_documentation-internal_docstrings" href="#Mooncake.is_reachable_return_node-Tuple{Core.ReturnNode}-developer_documentation-internal_docstrings"><code>Mooncake.is_reachable_return_node</code></a> — <span class="docstring-category">Method</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">is_reachable_return_node(x::ReturnNode)</code></pre><p>Determine whether <code>x</code> is a <code>ReturnNode</code>, and if it is, if it is also reachable. This is purely a function of whether or not its <code>val</code> field is defined or not.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/compintell/Mooncake.jl/blob/9f19358ec93a14f67ccd63773de4a19f4c9f35fd/src/interpreter/ir_utils.jl#L239-L244">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Mooncake.is_unreachable_return_node-Tuple{Core.ReturnNode}-developer_documentation-internal_docstrings" href="#Mooncake.is_unreachable_return_node-Tuple{Core.ReturnNode}-developer_documentation-internal_docstrings"><code>Mooncake.is_unreachable_return_node</code></a> — <span class="docstring-category">Method</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">is_unreachable_return_node(x::ReturnNode)</code></pre><p>Determine whehter <code>x</code> is a <code>ReturnNode</code>, and if it is, if it is also unreachable. This is purely a function of whether or not its <code>val</code> field is defined or not.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/compintell/Mooncake.jl/blob/9f19358ec93a14f67ccd63773de4a19f4c9f35fd/src/interpreter/ir_utils.jl#L248-L253">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Mooncake.lgetfield-Union{Tuple{f}, Tuple{Any, Val{f}}} where f-developer_documentation-internal_docstrings" href="#Mooncake.lgetfield-Union{Tuple{f}, Tuple{Any, Val{f}}} where f-developer_documentation-internal_docstrings"><code>Mooncake.lgetfield</code></a> — <span class="docstring-category">Method</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">lgetfield(x, f::Val)</code></pre><p>An implementation of <code>getfield</code> in which the the field <code>f</code> is specified statically via a <code>Val</code>. This enables the implementation to be type-stable even when it is not possible to constant-propagate <code>f</code>. Moreover, it enable the pullback to also be type-stable.</p><p>It will always be the case that</p><pre><code class="language-julia hljs">getfield(x, :f) === lgetfield(x, Val(:f))
getfield(x, 2) === lgetfield(x, Val(2))</code></pre><p>This approach is identical to the one taken by <code>Zygote.jl</code> to circumvent the same problem. <code>Zygote.jl</code> calls the function <code>literal_getfield</code>, while we call it <code>lgetfield</code>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/compintell/Mooncake.jl/blob/9f19358ec93a14f67ccd63773de4a19f4c9f35fd/src/rrules/misc.jl#L42-L57">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Mooncake.lgetfield-Union{Tuple{order}, Tuple{f}, Tuple{Any, Val{f}, Val{order}}} where {f, order}-developer_documentation-internal_docstrings" href="#Mooncake.lgetfield-Union{Tuple{order}, Tuple{f}, Tuple{Any, Val{f}, Val{order}}} where {f, order}-developer_documentation-internal_docstrings"><code>Mooncake.lgetfield</code></a> — <span class="docstring-category">Method</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">lgetfield(x, ::Val{f}, ::Val{order}) where {f, order}</code></pre><p>Like <code>getfield</code>, but with the field and access order encoded as types.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/compintell/Mooncake.jl/blob/9f19358ec93a14f67ccd63773de4a19f4c9f35fd/src/utils.jl#L192-L196">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Mooncake.lift_gc_preservation-Tuple{Any}-developer_documentation-internal_docstrings" href="#Mooncake.lift_gc_preservation-Tuple{Any}-developer_documentation-internal_docstrings"><code>Mooncake.lift_gc_preservation</code></a> — <span class="docstring-category">Method</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">lift_gc_preserve(inst)</code></pre><p>Expressions of the form</p><pre><code class="language-julia hljs">y = GC.@preserve x1 x2 foo(args...)</code></pre><p>get lowered to</p><pre><code class="language-julia hljs">token = Expr(:gc_preserve_begin, x1, x2)
y = expr
Expr(:gc_preserve_end, token)</code></pre><p>These expressions guarantee that any memory associated <code>x1</code> and <code>x2</code> not be freed until the <code>:gc_preserve_end</code> expression is reached.</p><p>In the context of reverse-mode AD, we must ensure that the memory associated to <code>x1</code>, <code>x2</code> and their fdata is available during the reverse pass code associated to <code>expr</code>. We do this by preventing the memory from being freed until the <code>:gc_preserve_begin</code> is reached on the reverse pass.</p><p>To achieve this, we replace the primal code with</p><pre><code class="language-julia hljs"># store `x` in `pb_gc_preserve` to prevent it from being freed.
_, pb_gc_preserve = rrule!!(zero_fcodual(gc_preserve), x1, x2)

# Differentiate the `:call` expression in the usual way.
y, foo_pb = rrule!!(zero_fcodual(foo), args...)

# Do not permit the GC to free `x` here.
nothing</code></pre><p>The pullback should be something along the lines of</p><pre><code class="language-julia hljs"># no pullback associated to `nothing`.
nothing

# Run the pullback associated to `foo` in the usual manner. `x` must be available.
_, dargs... = foo_pb(dy)

# No-op pullback associated to `gc_preserve`.
pb_gc_preserve(NoRData())</code></pre></div><a class="docs-sourcelink" target="_blank" href="https://github.com/compintell/Mooncake.jl/blob/9f19358ec93a14f67ccd63773de4a19f4c9f35fd/src/interpreter/ir_normalisation.jl#L273-L316">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Mooncake.lift_getfield_and_others-Tuple{Any}-developer_documentation-internal_docstrings" href="#Mooncake.lift_getfield_and_others-Tuple{Any}-developer_documentation-internal_docstrings"><code>Mooncake.lift_getfield_and_others</code></a> — <span class="docstring-category">Method</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">lift_getfield_and_others(inst)</code></pre><p>Converts expressions of the form <code>getfield(x, :a)</code> into <code>lgetfield(x, Val(:a))</code>. This has identical semantics, but is performant in the absence of proper constant propagation.</p><p>Does the same for...</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/compintell/Mooncake.jl/blob/9f19358ec93a14f67ccd63773de4a19f4c9f35fd/src/interpreter/ir_normalisation.jl#L183-L190">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Mooncake.lookup_ir-Tuple{Core.Compiler.AbstractInterpreter, Type{&lt;:Tuple}}-developer_documentation-internal_docstrings" href="#Mooncake.lookup_ir-Tuple{Core.Compiler.AbstractInterpreter, Type{&lt;:Tuple}}-developer_documentation-internal_docstrings"><code>Mooncake.lookup_ir</code></a> — <span class="docstring-category">Method</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">lookup_ir(
    interp::AbstractInterpreter,
    sig_or_mi::Union{Type{&lt;:Tuple}, Core.MethodInstance},
)::Tuple{IRCode, T}</code></pre><p>Get the unique IR associated to <code>sig_or_mi</code> under <code>interp</code>. Throws <code>ArgumentError</code>s if there is no code found, or if more than one <code>IRCode</code> instance returned.</p><p>Returns a tuple containing the <code>IRCode</code> and its return type.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/compintell/Mooncake.jl/blob/9f19358ec93a14f67ccd63773de4a19f4c9f35fd/src/interpreter/ir_utils.jl#L186-L196">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Mooncake.lsetfield!-Union{Tuple{name}, Tuple{Any, Val{name}, Any}} where name-developer_documentation-internal_docstrings" href="#Mooncake.lsetfield!-Union{Tuple{name}, Tuple{Any, Val{name}, Any}} where name-developer_documentation-internal_docstrings"><code>Mooncake.lsetfield!</code></a> — <span class="docstring-category">Method</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">lsetfield!(value, name::Val, x, [order::Val])</code></pre><p>This function is to <code>setfield!</code> what <code>lgetfield</code> is to <code>getfield</code>. It will always hold that</p><pre><code class="language-julia hljs">setfield!(copy(x), :f, v) == lsetfield!(copy(x), Val(:f), v)
setfield!(copy(x), 2, v) == lsetfield(copy(x), Val(2), v)</code></pre></div><a class="docs-sourcelink" target="_blank" href="https://github.com/compintell/Mooncake.jl/blob/9f19358ec93a14f67ccd63773de4a19f4c9f35fd/src/utils.jl#L199-L207">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Mooncake.new_inst-developer_documentation-internal_docstrings" href="#Mooncake.new_inst-developer_documentation-internal_docstrings"><code>Mooncake.new_inst</code></a> — <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">new_inst(stmt, type=Any, flag=CC.IR_FLAG_REFINED)::NewInstruction</code></pre><p>Create a <code>NewInstruction</code> with fields:</p><ul><li><code>stmt</code> = <code>stmt</code></li><li><code>type</code> = <code>type</code></li><li><code>info</code> = <code>CC.NoCallInfo()</code></li><li><code>line</code> = <code>Int32(1)</code></li><li><code>flag</code> = <code>flag</code></li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/compintell/Mooncake.jl/blob/9f19358ec93a14f67ccd63773de4a19f4c9f35fd/src/interpreter/ir_utils.jl#L298-L307">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Mooncake.new_to_call-Tuple{Any}-developer_documentation-internal_docstrings" href="#Mooncake.new_to_call-Tuple{Any}-developer_documentation-internal_docstrings"><code>Mooncake.new_to_call</code></a> — <span class="docstring-category">Method</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">new_to_call(x)</code></pre><p>If instruction <code>x</code> is a <code>:new</code> expression, replace it with a <code>:call</code> to <code>Mooncake._new_</code>. Otherwise, return <code>x</code>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/compintell/Mooncake.jl/blob/9f19358ec93a14f67ccd63773de4a19f4c9f35fd/src/interpreter/ir_normalisation.jl#L143-L148">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Mooncake.normalise!-Tuple{Core.Compiler.IRCode, Vector{Symbol}}-developer_documentation-internal_docstrings" href="#Mooncake.normalise!-Tuple{Core.Compiler.IRCode, Vector{Symbol}}-developer_documentation-internal_docstrings"><code>Mooncake.normalise!</code></a> — <span class="docstring-category">Method</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">normalise!(ir::IRCode, spnames::Vector{Symbol})</code></pre><p>Apply a sequence of standardising transformations to <code>ir</code> which leaves its semantics unchanged, but makes AD more straightforward. In particular, replace</p><ol><li><code>:foreigncall</code> <code>Expr</code>s with <code>:call</code>s to <code>Mooncake._foreigncall_</code>,</li><li><code>:new</code> <code>Expr</code>s with <code>:call</code>s to <code>Mooncake._new_</code>,</li><li><code>:splatnew</code> Expr<code>s with</code>:call<code>s to</code>Mooncake.<em>splat</em>new_`,</li><li><code>Core.IntrinsicFunction</code>s with counterparts from <code>Mooncake.IntrinsicWrappers</code>,</li><li><code>getfield(x, 1)</code> with <code>lgetfield(x, Val(1))</code>, and related transformations,</li><li><code>gc_preserve_begin</code> / <code>gc_preserve_end</code> exprs so that memory release is delayed.</li></ol><p><code>spnames</code> are the names associated to the static parameters of <code>ir</code>. These are needed when handling <code>:foreigncall</code> expressions, in which it is not necessarily the case that all static parameter names have been translated into either types, or <code>:static_parameter</code> expressions.</p><p>Unfortunately, the static parameter names are not retained in <code>IRCode</code>, and the <code>Method</code> from which the <code>IRCode</code> is derived must be consulted. <code>Mooncake.is_vararg_and_sparam_names</code> provides a convenient way to do this.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/compintell/Mooncake.jl/blob/9f19358ec93a14f67ccd63773de4a19f4c9f35fd/src/interpreter/ir_normalisation.jl#L1-L21">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Mooncake.optimise_ir!-Tuple{Core.Compiler.IRCode}-developer_documentation-internal_docstrings" href="#Mooncake.optimise_ir!-Tuple{Core.Compiler.IRCode}-developer_documentation-internal_docstrings"><code>Mooncake.optimise_ir!</code></a> — <span class="docstring-category">Method</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">optimise_ir!(ir::IRCode, show_ir=false)</code></pre><p>Run a fairly standard optimisation pass on <code>ir</code>. If <code>show_ir</code> is <code>true</code>, displays the IR to <code>stdout</code> at various points in the pipeline – this is sometimes useful for debugging.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/compintell/Mooncake.jl/blob/9f19358ec93a14f67ccd63773de4a19f4c9f35fd/src/interpreter/ir_utils.jl#L133-L138">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Mooncake.phi_nodes-Tuple{Mooncake.BBlock}-developer_documentation-internal_docstrings" href="#Mooncake.phi_nodes-Tuple{Mooncake.BBlock}-developer_documentation-internal_docstrings"><code>Mooncake.phi_nodes</code></a> — <span class="docstring-category">Method</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">phi_nodes(bb::BBlock)::Tuple{Vector{ID}, Vector{IDPhiNode}}</code></pre><p>Returns all of the <code>IDPhiNode</code>s at the start of <code>bb</code>, along with their <code>ID</code>s. If there are no <code>IDPhiNode</code>s at the start of <code>bb</code>, then both vectors will be empty.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/compintell/Mooncake.jl/blob/9f19358ec93a14f67ccd63773de4a19f4c9f35fd/src/interpreter/bbcode.jl#L165-L170">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Mooncake.primal_ir-Tuple{Type{&lt;:Tuple}}-developer_documentation-internal_docstrings" href="#Mooncake.primal_ir-Tuple{Type{&lt;:Tuple}}-developer_documentation-internal_docstrings"><code>Mooncake.primal_ir</code></a> — <span class="docstring-category">Method</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">primal_ir(sig::Type{&lt;:Tuple}; interp=get_interpreter())::IRCode</code></pre><p>!!! warning: this is not part of the public interface of Mooncake. As such, it may change as part of a non-breaking release of the package.</p><p>Get the <code>Core.Compiler.IRCode</code> associated to <code>sig</code> from which the a rule can be derived. Roughly equivalent to <code>Base.code_ircode_by_type(sig; interp)</code>.</p><p>For example, if you wanted to get the IR associated to the call <code>map(sin, randn(10))</code>, you could do one of the following calls:</p><pre><code class="language-julia-repl hljs">julia&gt; Mooncake.primal_ir(Tuple{typeof(map), typeof(sin), Vector{Float64}}) isa Core.Compiler.IRCode
true
julia&gt; Mooncake.primal_ir(typeof((map, sin, randn(10)))) isa Core.Compiler.IRCode
true</code></pre></div><a class="docs-sourcelink" target="_blank" href="https://github.com/compintell/Mooncake.jl/blob/9f19358ec93a14f67ccd63773de4a19f4c9f35fd/src/developer_tools.jl#L1-L18">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Mooncake.rdata_field_type-Union{Tuple{P}, Tuple{Type{P}, Int64}} where P-developer_documentation-internal_docstrings" href="#Mooncake.rdata_field_type-Union{Tuple{P}, Tuple{Type{P}, Int64}} where P-developer_documentation-internal_docstrings"><code>Mooncake.rdata_field_type</code></a> — <span class="docstring-category">Method</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">rdata_field_type(::Type{P}, n::Int) where {P}</code></pre><p>Returns the type of to the nth field of the rdata type associated to <code>P</code>. Will be a <code>PossiblyUninitTangent</code> if said field can be undefined.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/compintell/Mooncake.jl/blob/9f19358ec93a14f67ccd63773de4a19f4c9f35fd/src/fwds_rvs_data.jl#L465-L470">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Mooncake.remove_unreachable_blocks!-Tuple{Mooncake.BBCode}-developer_documentation-internal_docstrings" href="#Mooncake.remove_unreachable_blocks!-Tuple{Mooncake.BBCode}-developer_documentation-internal_docstrings"><code>Mooncake.remove_unreachable_blocks!</code></a> — <span class="docstring-category">Method</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">remove_unreachable_blocks!(ir::BBCode)::BBCode</code></pre><p>If a basic block in <code>ir</code> cannot possibly be reached during execution, then it can be safely removed from <code>ir</code> without changing its functionality. A block is unreachable if either:</p><ol><li>it has no predecessors <em>and</em> it is not the first block, or</li><li>all of its predecessors are themselves unreachable.</li></ol><p>For example, consider the following IR:</p><pre><code class="language-julia-repl hljs">julia&gt; ir = Mooncake.ircode(
           Any[Core.ReturnNode(nothing), Expr(:call, sin, 5), Core.ReturnNode(Core.SSAValue(2))],
           Any[Any, Any, Any],
       );</code></pre><p>There is no possible way to reach the second basic block (lines 2 and 3). Applying this function will therefore remove it, yielding the following:</p><pre><code class="language-julia-repl hljs">julia&gt; Mooncake.IRCode(Mooncake.remove_unreachable_blocks!(Mooncake.BBCode(ir)))
1 1 ─     return nothing</code></pre><p>In the blocks which have not been removed, there may be references to blocks which have been removed. For example, the <code>edge</code>s in a <code>PhiNode</code> may contain a reference to a removed block. These references are removed in-place from these remaining blocks, so this function will (in general) modify <code>ir</code>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/compintell/Mooncake.jl/blob/9f19358ec93a14f67ccd63773de4a19f4c9f35fd/src/interpreter/bbcode.jl#L814-L841">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Mooncake.replace_uses_with!-Tuple{Any, Union{Core.Argument, Core.SSAValue}, Any}-developer_documentation-internal_docstrings" href="#Mooncake.replace_uses_with!-Tuple{Any, Union{Core.Argument, Core.SSAValue}, Any}-developer_documentation-internal_docstrings"><code>Mooncake.replace_uses_with!</code></a> — <span class="docstring-category">Method</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">replace_uses_with!(stmt, def::Union{Argument, SSAValue}, val)</code></pre><p>Replace all uses of <code>def</code> with <code>val</code> in the single statement <code>stmt</code>. Note: this function is highly incomplete, really only working correctly for a specific function in <code>ir_normalisation.jl</code>. You probably do not want to use it.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/compintell/Mooncake.jl/blob/9f19358ec93a14f67ccd63773de4a19f4c9f35fd/src/interpreter/ir_utils.jl#L312-L318">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Mooncake.rrule_wrapper-Union{NTuple{N, Mooncake.CoDual}, Tuple{N}} where N-developer_documentation-internal_docstrings" href="#Mooncake.rrule_wrapper-Union{NTuple{N, Mooncake.CoDual}, Tuple{N}} where N-developer_documentation-internal_docstrings"><code>Mooncake.rrule_wrapper</code></a> — <span class="docstring-category">Method</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">rrule_wrapper(f::CoDual, args::CoDual...)</code></pre><p>Used to implement <code>rrule!!</code>s via <code>ChainRulesCore.rrule</code>.</p><p>Given a function <code>foo</code>, argument types <code>arg_types</code>, and a method of <code>ChainRulesCore.rrule</code> which applies to these, you can make use of this function as follows:</p><pre><code class="language-julia hljs">Mooncake.@is_primitive DefaultCtx Tuple{typeof(foo), arg_types...}
function Mooncake.rrule!!(f::CoDual{typeof(foo)}, args::CoDual...)
    return rrule_wrapper(f, args...)
end</code></pre><p>Assumes that methods of <code>to_cr_tangent</code> and <code>to_mooncake_tangent</code> are defined such that you can convert between the different representations of tangents that Mooncake and ChainRulesCore expect.</p><p>Furthermore, it is <em>essential</em> that</p><ol><li><code>f(args)</code> does not mutate <code>f</code> or <code>args</code>, and</li><li>the result of <code>f(args)</code> does not alias any data stored in <code>f</code> or <code>args</code>.</li></ol><p>Subject to some constraints, you can use the <a href="../../utilities/tools_for_rules/#Mooncake.@from_rrule"><code>@from_rrule</code></a> macro to reduce the amount of boilerplate code that you are required to write even further.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/compintell/Mooncake.jl/blob/9f19358ec93a14f67ccd63773de4a19f4c9f35fd/src/tools_for_rules.jl#L259-L282">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Mooncake.rvs_ir-Tuple{Type{&lt;:Tuple}}-developer_documentation-internal_docstrings" href="#Mooncake.rvs_ir-Tuple{Type{&lt;:Tuple}}-developer_documentation-internal_docstrings"><code>Mooncake.rvs_ir</code></a> — <span class="docstring-category">Method</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">rvs_ir(
    sig::Type{&lt;:Tuple};
    interp=get_interpreter(), debug_mode::Bool=false, do_inline::Bool=true
)::IRCode</code></pre><p>!!! warning: this is not part of the public interface of Mooncake. As such, it may change as part of a non-breaking release of the package.</p><p>Generate the <code>Core.Compiler.IRCode</code> used to construct the reverse-pass of AD. Take a look at how <code>build_rrule</code> makes use of <code>generate_ir</code> to see exactly how this is used in practice.</p><p>For example, if you wanted to get the IR associated to the reverse pass for the call <code>map(sin, randn(10))</code>, you could do either of the following:</p><pre><code class="language-julia-repl hljs">julia&gt; Mooncake.rvs_ir(Tuple{typeof(map), typeof(sin), Vector{Float64}}) isa Core.Compiler.IRCode
true
julia&gt; Mooncake.rvs_ir(typeof((map, sin, randn(10)))) isa Core.Compiler.IRCode
true</code></pre><p><strong>Arguments</strong></p><ul><li><code>sig::Type{&lt;:Tuple}</code>: the signature of the call to be differentiated.</li></ul><p><strong>Keyword Arguments</strong></p><ul><li><code>interp</code>: the interpreter to use to obtain the primal IR.</li><li><code>debug_mode::Bool</code>: whether the generated IR should make use of Mooncake&#39;s debug mode.</li><li><code>do_inline::Bool</code>: whether to apply an inlining pass prior to returning the ir generated   by this function. This is <code>true</code> by default, but setting it to <code>false</code> can sometimes be   helpful if you need to understand what function calls are generated in order to perform   AD, before lots of it gets inlined away.</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/compintell/Mooncake.jl/blob/9f19358ec93a14f67ccd63773de4a19f4c9f35fd/src/developer_tools.jl#L62-L93">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Mooncake.seed_id!-Tuple{}-developer_documentation-internal_docstrings" href="#Mooncake.seed_id!-Tuple{}-developer_documentation-internal_docstrings"><code>Mooncake.seed_id!</code></a> — <span class="docstring-category">Method</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">seed_id!()</code></pre><p>Set the global counter used to ensure ID uniqueness to 0. This is useful when you want to ensure determinism between two runs of the same function which makes use of <code>ID</code>s.</p><p>This is akin to setting the random seed associated to a random number generator globally.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/compintell/Mooncake.jl/blob/9f19358ec93a14f67ccd63773de4a19f4c9f35fd/src/interpreter/bbcode.jl#L26-L33">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Mooncake.set_tangent_field!-Union{Tuple{Tfields}, Tuple{MutableTangent{Tfields}, Int64, Any}} where Tfields-developer_documentation-internal_docstrings" href="#Mooncake.set_tangent_field!-Union{Tuple{Tfields}, Tuple{MutableTangent{Tfields}, Int64, Any}} where Tfields-developer_documentation-internal_docstrings"><code>Mooncake.set_tangent_field!</code></a> — <span class="docstring-category">Method</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">set_tangent_field!(t::MutableTangent{Tfields}, i::Int, x) where {Tfields}</code></pre><p>Sets the value of the <code>i</code>th field of the data in <code>t</code> to value <code>x</code>.</p><p>Has the same semantics that <code>setfield!</code> would have if the data in the <code>fields</code> field of <code>t</code> were actually fields of <code>t</code>. This is the moral equivalent of <code>setfield!</code> for <code>MutableTangent</code>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/compintell/Mooncake.jl/blob/9f19358ec93a14f67ccd63773de4a19f4c9f35fd/src/tangents.jl#L91-L99">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Mooncake.splatnew_to_call-Tuple{Any}-developer_documentation-internal_docstrings" href="#Mooncake.splatnew_to_call-Tuple{Any}-developer_documentation-internal_docstrings"><code>Mooncake.splatnew_to_call</code></a> — <span class="docstring-category">Method</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">splatnew_to_call(x)</code></pre><p>If instruction <code>x</code> is a <code>:splatnew</code> expression, replace it with a <code>:call</code> to <code>Mooncake._splat_new_</code>. Otherwise return <code>x</code>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/compintell/Mooncake.jl/blob/9f19358ec93a14f67ccd63773de4a19f4c9f35fd/src/interpreter/ir_normalisation.jl#L151-L156">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Mooncake.tangent_field_type-Union{Tuple{P}, Tuple{Type{P}, Int64}} where P-developer_documentation-internal_docstrings" href="#Mooncake.tangent_field_type-Union{Tuple{P}, Tuple{Type{P}, Int64}} where P-developer_documentation-internal_docstrings"><code>Mooncake.tangent_field_type</code></a> — <span class="docstring-category">Method</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">tangent_field_type(::Type{P}, n::Int) where {P}</code></pre><p>Returns the type that lives in the nth elements of <code>fields</code> in a <code>Tangent</code> / <code>MutableTangent</code>. Will either be the <code>tangent_type</code> of the nth fieldtype of <code>P</code>, or the <code>tangent_type</code> wrapped in a <code>PossiblyUninitTangent</code>. The latter case only occurs if it is possible for the field to be undefined.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/compintell/Mooncake.jl/blob/9f19358ec93a14f67ccd63773de4a19f4c9f35fd/src/tangents.jl#L408-L415">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Mooncake.tangent_test_cases-Tuple{}-developer_documentation-internal_docstrings" href="#Mooncake.tangent_test_cases-Tuple{}-developer_documentation-internal_docstrings"><code>Mooncake.tangent_test_cases</code></a> — <span class="docstring-category">Method</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">tangent_test_cases()</code></pre><p>Constructs a <code>Vector</code> of <code>Tuple</code>s containing test cases for the tangent infrastructure.</p><p>If the returned tuple has 2 elements, the elements should be interpreted as follows: 1 - interface_only 2 - primal value</p><p>interface_only is a Bool which will be used to determine which subset of tests to run.</p><p>If the returned tuple has 5 elements, then the elements are interpreted as follows: 1 - interface_only 2 - primal value 3, 4, 5 - tangents, where &lt;5&gt; == increment!!(&lt;3&gt;, &lt;4&gt;).</p><p>Test cases in the first format make use of <code>zero_tangent</code> / <code>randn_tangent</code> etc to generate tangents, but they&#39;re unable to check that <code>increment!!</code> is correct in an absolute sense.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/compintell/Mooncake.jl/blob/9f19358ec93a14f67ccd63773de4a19f4c9f35fd/src/tangents.jl#L812-L830">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Mooncake.terminator-Tuple{Mooncake.BBlock}-developer_documentation-internal_docstrings" href="#Mooncake.terminator-Tuple{Mooncake.BBlock}-developer_documentation-internal_docstrings"><code>Mooncake.terminator</code></a> — <span class="docstring-category">Method</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">terminator(bb::BBlock)</code></pre><p>Returns the terminator associated to <code>bb</code>. If the last instruction in <code>bb</code> isa <code>Terminator</code> then that is returned, otherwise <code>nothing</code> is returned.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/compintell/Mooncake.jl/blob/9f19358ec93a14f67ccd63773de4a19f4c9f35fd/src/interpreter/bbcode.jl#L190-L195">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Mooncake.to_cr_tangent-Tuple{Union{Float16, Float32, Float64}}-developer_documentation-internal_docstrings" href="#Mooncake.to_cr_tangent-Tuple{Union{Float16, Float32, Float64}}-developer_documentation-internal_docstrings"><code>Mooncake.to_cr_tangent</code></a> — <span class="docstring-category">Method</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">to_cr_tangent(t)</code></pre><p>Convert a Mooncake tangent into a type that ChainRules.jl <code>rrule</code>s expect to see.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/compintell/Mooncake.jl/blob/9f19358ec93a14f67ccd63773de4a19f4c9f35fd/src/tools_for_rules.jl#L230-L234">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Mooncake.tuple_map-Union{Tuple{F}, Tuple{F, Tuple}} where F-developer_documentation-internal_docstrings" href="#Mooncake.tuple_map-Union{Tuple{F}, Tuple{F, Tuple}} where F-developer_documentation-internal_docstrings"><code>Mooncake.tuple_map</code></a> — <span class="docstring-category">Method</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">tuple_map(f::F, x::Tuple) where {F}</code></pre><p>This function is largely equivalent to <code>map(f, x)</code>, but always specialises on all of the element types of <code>x</code>, regardless the length of <code>x</code>. This contrasts with <code>map</code>, in which the number of element types specialised upon is a fixed constant in the compiler.</p><p>As a consequence, if <code>x</code> is very long, this function may have very large compile times.</p><pre><code class="nohighlight hljs">tuple_map(f::F, x::Tuple, y::Tuple) where {F}</code></pre><p>Binary extension of <code>tuple_map</code>. Nearly equivalent to <code>map(f, x, y)</code>, but guaranteed to specialise on all element types of <code>x</code> and <code>y</code>. Furthermore, errors if <code>x</code> and <code>y</code> aren&#39;t the same length, while <code>map</code> will just produce a new tuple whose length is equal to the shorter of <code>x</code> and <code>y</code>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/compintell/Mooncake.jl/blob/9f19358ec93a14f67ccd63773de4a19f4c9f35fd/src/utils.jl#L10-L25">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Mooncake.unhandled_feature-Tuple{String}-developer_documentation-internal_docstrings" href="#Mooncake.unhandled_feature-Tuple{String}-developer_documentation-internal_docstrings"><code>Mooncake.unhandled_feature</code></a> — <span class="docstring-category">Method</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">unhandled_feature(msg::String)</code></pre><p>Throw an <code>UnhandledLanguageFeatureException</code> with message <code>msg</code>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/compintell/Mooncake.jl/blob/9f19358ec93a14f67ccd63773de4a19f4c9f35fd/src/interpreter/ir_utils.jl#L267-L271">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Mooncake.uninit_codual-Tuple{Any}-developer_documentation-internal_docstrings" href="#Mooncake.uninit_codual-Tuple{Any}-developer_documentation-internal_docstrings"><code>Mooncake.uninit_codual</code></a> — <span class="docstring-category">Method</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">uninit_codual(x)</code></pre><p>Equivalent to <code>CoDual(x, uninit_tangent(x))</code>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/compintell/Mooncake.jl/blob/9f19358ec93a14f67ccd63773de4a19f4c9f35fd/src/codual.jl#L27-L31">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Mooncake.uninit_fcodual-Tuple{P} where P-developer_documentation-internal_docstrings" href="#Mooncake.uninit_fcodual-Tuple{P} where P-developer_documentation-internal_docstrings"><code>Mooncake.uninit_fcodual</code></a> — <span class="docstring-category">Method</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">uninit_fcodual(x)</code></pre><p>Like <code>zero_fcodual</code>, but doesn&#39;t guarantee that the value of the fdata is initialised. See implementation for details, as this function is subject to change.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/compintell/Mooncake.jl/blob/9f19358ec93a14f67ccd63773de4a19f4c9f35fd/src/codual.jl#L81-L86">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Mooncake.uninit_tangent-Tuple{Any}-developer_documentation-internal_docstrings" href="#Mooncake.uninit_tangent-Tuple{Any}-developer_documentation-internal_docstrings"><code>Mooncake.uninit_tangent</code></a> — <span class="docstring-category">Method</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">uninit_tangent(x)</code></pre><p>Related to <code>zero_tangent</code>, but a bit different. Check current implementation for details – this docstring is intentionally non-specific in order to avoid becoming outdated.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/compintell/Mooncake.jl/blob/9f19358ec93a14f67ccd63773de4a19f4c9f35fd/src/tangents.jl#L492-L497">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Mooncake.verify_fdata_type-Tuple{Type, Type}-developer_documentation-internal_docstrings" href="#Mooncake.verify_fdata_type-Tuple{Type, Type}-developer_documentation-internal_docstrings"><code>Mooncake.verify_fdata_type</code></a> — <span class="docstring-category">Method</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">verify_fdata_type(P::Type, F::Type)::Nothing</code></pre><p>Check that <code>F</code> is a valid type for fdata associated to a primal of type <code>P</code>. Returns <code>nothing</code> if valid, throws an <code>InvalidFDataException</code> if a problem is found.</p><p>This applies to both concrete and non-concrete <code>P</code>. For example, if <code>P</code> is the type inferred for a primal <code>q::Q</code>, such that <code>Q &lt;: P</code>, then this method is still applicable.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/compintell/Mooncake.jl/blob/9f19358ec93a14f67ccd63773de4a19f4c9f35fd/src/fwds_rvs_data.jl#L273-L281">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Mooncake.verify_fdata_value-Tuple{Any, Any}-developer_documentation-internal_docstrings" href="#Mooncake.verify_fdata_value-Tuple{Any, Any}-developer_documentation-internal_docstrings"><code>Mooncake.verify_fdata_value</code></a> — <span class="docstring-category">Method</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">verify_fdata_value(p, f)::Nothing</code></pre><p>Check that <code>f</code> cannot be proven to be invalid fdata for <code>p</code>.</p><p>This method attempts to provide some confidence that <code>f</code> is valid fdata for <code>p</code> by checking a collection of necessary conditions. We do not guarantee that these amount to a sufficient condition, just that they rule out a variety of common problems.</p><p>Put differently, we cannot prove that <code>f</code> is valid fdata, only that it is not obviously invalid.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/compintell/Mooncake.jl/blob/9f19358ec93a14f67ccd63773de4a19f4c9f35fd/src/fwds_rvs_data.jl#L288-L299">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Mooncake.verify_rdata_type-Tuple{Type, Type}-developer_documentation-internal_docstrings" href="#Mooncake.verify_rdata_type-Tuple{Type, Type}-developer_documentation-internal_docstrings"><code>Mooncake.verify_rdata_type</code></a> — <span class="docstring-category">Method</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">verify_rdata_type(P::Type, R::Type)::Nothing</code></pre><p>Check that <code>R</code> is a valid type for rdata associated to a primal of type <code>P</code>. Returns <code>nothing</code> if valid, throws an <code>InvalidRDataException</code> if a problem is found.</p><p>This applies to both concrete and non-concrete <code>P</code>. For example, if <code>P</code> is the type inferred for a primal <code>q::Q</code>, such that <code>Q &lt;: P</code>, then this method is still applicable.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/compintell/Mooncake.jl/blob/9f19358ec93a14f67ccd63773de4a19f4c9f35fd/src/fwds_rvs_data.jl#L667-L675">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Mooncake.verify_rdata_value-Tuple{Any, Any}-developer_documentation-internal_docstrings" href="#Mooncake.verify_rdata_value-Tuple{Any, Any}-developer_documentation-internal_docstrings"><code>Mooncake.verify_rdata_value</code></a> — <span class="docstring-category">Method</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">verify_rdata_value(p, r)::Nothing</code></pre><p>Check that <code>r</code> cannot be proven to be invalid rdata for <code>p</code>.</p><p>This method attempts to provide some confidence that <code>r</code> is valid rdata for <code>p</code> by checking a collection of necessary conditions. We do not guarantee that these amount to a sufficient condition, just that they rule out a variety of common problems.</p><p>Put differently, we cannot prove that <code>r</code> is valid rdata, only that it is not obviously invalid.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/compintell/Mooncake.jl/blob/9f19358ec93a14f67ccd63773de4a19f4c9f35fd/src/fwds_rvs_data.jl#L682-L693">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Mooncake.zero_adjoint-Union{Tuple{N}, Tuple{Mooncake.CoDual, Vararg{Mooncake.CoDual, N}}} where N-developer_documentation-internal_docstrings" href="#Mooncake.zero_adjoint-Union{Tuple{N}, Tuple{Mooncake.CoDual, Vararg{Mooncake.CoDual, N}}} where N-developer_documentation-internal_docstrings"><code>Mooncake.zero_adjoint</code></a> — <span class="docstring-category">Method</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">zero_adjoint(f::CoDual, x::Vararg{CoDual, N}) where {N}</code></pre><p>Utility functionality for constructing <code>rrule!!</code>s for functions which produce adjoints which always return zero.</p><p>NOTE: you should only make use of this function if you cannot make use of the <a href="../../utilities/tools_for_rules/#Mooncake.@zero_adjoint"><code>@zero_adjoint</code></a> macro.</p><p>You make use of this functionality by writing a method of <code>Mooncake.rrule!!</code>, and passing all of its arguments (including the function itself) to this function. For example:</p><pre><code class="language-julia-repl hljs">julia&gt; import Mooncake: zero_adjoint, DefaultCtx, zero_fcodual, rrule!!, is_primitive, CoDual

julia&gt; foo(x::Vararg{Int}) = 5
foo (generic function with 1 method)

julia&gt; is_primitive(::Type{DefaultCtx}, ::Type{&lt;:Tuple{typeof(foo), Vararg{Int}}}) = true;

julia&gt; rrule!!(f::CoDual{typeof(foo)}, x::Vararg{CoDual{Int}}) = zero_adjoint(f, x...);

julia&gt; rrule!!(zero_fcodual(foo), zero_fcodual(3), zero_fcodual(2))[2](NoRData())
(NoRData(), NoRData(), NoRData())</code></pre><p>WARNING: this is only correct if the output of <code>primal(f)(map(primal, x)...)</code> does not alias anything in <code>f</code> or <code>x</code>. This is always the case if the result is a bits type, but more care may be required if it is not. ```</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/compintell/Mooncake.jl/blob/9f19358ec93a14f67ccd63773de4a19f4c9f35fd/src/tools_for_rules.jl#L107-L136">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Mooncake.zero_like_rdata_from_type-Union{Tuple{Type{P}}, Tuple{P}} where P-developer_documentation-internal_docstrings" href="#Mooncake.zero_like_rdata_from_type-Union{Tuple{Type{P}}, Tuple{P}} where P-developer_documentation-internal_docstrings"><code>Mooncake.zero_like_rdata_from_type</code></a> — <span class="docstring-category">Method</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">zero_like_rdata_from_type(::Type{P}) where {P}</code></pre><p>This is an internal implementation detail – you should generally not use this function.</p><p>Returns <em>either</em> the zero element of type <code>rdata_type(tangent_type(P))</code>, or a <code>ZeroRData</code>. It is always valid to return a <code>ZeroRData</code>, </p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/compintell/Mooncake.jl/blob/9f19358ec93a14f67ccd63773de4a19f4c9f35fd/src/interpreter/zero_like_rdata.jl#L27-L34">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Mooncake.zero_like_rdata_type-Union{Tuple{Type{P}}, Tuple{P}} where P-developer_documentation-internal_docstrings" href="#Mooncake.zero_like_rdata_type-Union{Tuple{Type{P}}, Tuple{P}} where P-developer_documentation-internal_docstrings"><code>Mooncake.zero_like_rdata_type</code></a> — <span class="docstring-category">Method</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">zero_like_rdata_type(::Type{P}) where {P}</code></pre><p>Indicates the type which will be returned by <code>zero_like_rdata_from_type</code>. Will be the rdata type for <code>P</code> if we can produce the zero rdata element given only <code>P</code>, and will be the union of <code>R</code> and <code>ZeroRData</code> if an instance of <code>P</code> is needed.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/compintell/Mooncake.jl/blob/9f19358ec93a14f67ccd63773de4a19f4c9f35fd/src/interpreter/zero_like_rdata.jl#L15-L21">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Mooncake.zero_rdata-Tuple{Any}-developer_documentation-internal_docstrings" href="#Mooncake.zero_rdata-Tuple{Any}-developer_documentation-internal_docstrings"><code>Mooncake.zero_rdata</code></a> — <span class="docstring-category">Method</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">zero_rdata(p)</code></pre><p>Given value <code>p</code>, return the zero element associated to its reverse data type.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/compintell/Mooncake.jl/blob/9f19358ec93a14f67ccd63773de4a19f4c9f35fd/src/fwds_rvs_data.jl#L517-L521">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Mooncake.zero_rdata_from_type-Union{Tuple{Type{P}}, Tuple{P}} where P-developer_documentation-internal_docstrings" href="#Mooncake.zero_rdata_from_type-Union{Tuple{Type{P}}, Tuple{P}} where P-developer_documentation-internal_docstrings"><code>Mooncake.zero_rdata_from_type</code></a> — <span class="docstring-category">Method</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">zero_rdata_from_type(::Type{P}) where {P}</code></pre><p>Returns the zero element of <code>rdata_type(tangent_type(P))</code> if this is possible given only <code>P</code>. If not possible, returns an instance of <code>CannotProduceZeroRDataFromType</code>.</p><p>For example, the zero rdata associated to any primal of type <code>Float64</code> is <code>0.0</code>, so for <code>Float64</code>s this function is simple. Similarly, if the rdata type for <code>P</code> is <code>NoRData</code>, that can simply be returned.</p><p>However, it is not possible to return the zero rdata element for abstract types e.g. <code>Real</code> as the type does not uniquely determine the zero element – the rdata type for <code>Real</code> is <code>Any</code>.</p><p>These considerations apply recursively to tuples / namedtuples / structs, etc.</p><p>If you encounter a type which this function returns <code>CannotProduceZeroRDataFromType</code>, but you believe this is done in error, please open an issue. This kind of problem does not constitute a correctness problem, but can be detrimental to performance, so should be dealt with.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/compintell/Mooncake.jl/blob/9f19358ec93a14f67ccd63773de4a19f4c9f35fd/src/fwds_rvs_data.jl#L587-L607">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Mooncake.@from_rrule-developer_documentation-internal_docstrings" href="#Mooncake.@from_rrule-developer_documentation-internal_docstrings"><code>Mooncake.@from_rrule</code></a> — <span class="docstring-category">Macro</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">@from_rrule ctx sig [has_kwargs=false]</code></pre><p>Convenience functionality to assist in using <code>ChainRulesCore.rrule</code>s to write <code>rrule!!</code>s.</p><p><strong>Arguments</strong></p><ul><li><code>ctx</code>: A Mooncake context type</li><li><code>sig</code>: the signature which you wish to assert should be a primitive in <code>Mooncake.jl</code>, and   use an existing <code>ChainRulesCore.rrule</code> to implement this functionality.</li><li><code>has_kwargs</code>: a <code>Bool</code> state whether or not the function has keyword arguments. This   feature has the same limitations as <code>ChainRulesCore.rrule</code> – the derivative w.r.t. all   kwargs must be zero.</li></ul><p><strong>Example Usage</strong></p><p><strong>A Basic Example</strong></p><pre><code class="language-julia-repl hljs">julia&gt; using Mooncake: @from_rrule, DefaultCtx, rrule!!, zero_fcodual, TestUtils

julia&gt; using ChainRulesCore

julia&gt; foo(x::Real) = 5x;

julia&gt; function ChainRulesCore.rrule(::typeof(foo), x::Real)
           foo_pb(Ω::Real) = ChainRulesCore.NoTangent(), 5Ω
           return foo(x), foo_pb
       end;

julia&gt; @from_rrule DefaultCtx Tuple{typeof(foo), Base.IEEEFloat}

julia&gt; rrule!!(zero_fcodual(foo), zero_fcodual(5.0))[2](1.0)
(NoRData(), 5.0)

julia&gt; # Check that the rule works as intended.
       TestUtils.test_rule(Xoshiro(123), foo, 5.0; is_primitive=true)
Test Passed</code></pre><p><strong>An Example with Keyword Arguments</strong></p><pre><code class="language-julia-repl hljs">julia&gt; using Mooncake: @from_rrule, DefaultCtx, rrule!!, zero_fcodual, TestUtils

julia&gt; using ChainRulesCore

julia&gt; foo(x::Real; cond::Bool) = cond ? 5x : 4x;

julia&gt; function ChainRulesCore.rrule(::typeof(foo), x::Real; cond::Bool)
           foo_pb(Ω::Real) = ChainRulesCore.NoTangent(), cond ? 5Ω : 4Ω
           return foo(x; cond), foo_pb
       end;

julia&gt; @from_rrule DefaultCtx Tuple{typeof(foo), Base.IEEEFloat} true

julia&gt; _, pb = rrule!!(
           zero_fcodual(Core.kwcall),
           zero_fcodual((cond=false, )),
           zero_fcodual(foo),
           zero_fcodual(5.0),
       );

julia&gt; pb(3.0)
(NoRData(), NoRData(), NoRData(), 12.0)

julia&gt; # Check that the rule works as intended.
       TestUtils.test_rule(
           Xoshiro(123), Core.kwcall, (cond=false, ), foo, 5.0; is_primitive=true
       )
Test Passed</code></pre><p>Notice that, in order to access the kwarg method we must call the method of <code>Core.kwcall</code>, as Mooncake&#39;s <code>rrule!!</code> does not itself permit the use of kwargs.</p><p><strong>Limitations</strong></p><p>It is your responsibility to ensure that</p><ol><li>calls with signature <code>sig</code> do not mutate their arguments,</li><li>the output of calls with signature <code>sig</code> does not alias any of the inputs.</li></ol><p>As with all hand-written rules, you should definitely make use of <a href="../../utilities/debugging_and_mwes/#Mooncake.TestUtils.test_rule"><code>TestUtils.test_rule</code></a> to verify correctness on some test cases.</p><p><strong>Argument Type Constraints</strong></p><p>Many methods of <code>ChainRuleCore.rrule</code> are implemented with very loose type constraints. For example, it would not be surprising to see a method of rrule with the signature</p><pre><code class="language-julia hljs">Tuple{typeof(rrule), typeof(foo), Real, AbstractVector{&lt;:Real}}</code></pre><p>There are a variety of reasons for this way of doing things, and whether it is a good idea to write rules for such generic objects has been debated at length.</p><p>Suffice it to say, you should not write rules for <em>this</em> package which are so generically typed. Rather, you should create rules for the subset of types for which you believe that the <code>ChainRulesCore.rrule</code> will work correctly, and leave this package to derive rules for the rest. For example, it is quite common to be confident that a given rule will work correctly for any <code>Base.IEEEFloat</code> argument, i.e. <code>Union{Float16, Float32, Float64}</code>, but it is usually not possible to know that the rule is correct for all possible subtypes of <code>Real</code> that someone might define.</p><p><strong>Conversions Between Different Tangent Type Systems</strong></p><p>Under the hood, this functionality relies on two functions: <code>Mooncake.to_cr_tangent</code>, and <code>Mooncake.increment_and_get_rdata!</code>. These two functions handle conversion to / from <code>Mooncake</code> tangent types and <code>ChainRulesCore</code> tangent types. This functionality is known to work well for simple types, but has not been tested to a great extent on complicated composite types. If <code>@from_rrule</code> does not work in your case because the required method of either of these functions does not exist, please open an issue.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/compintell/Mooncake.jl/blob/9f19358ec93a14f67ccd63773de4a19f4c9f35fd/src/tools_for_rules.jl#L338-L450">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Mooncake.@is_primitive-Tuple{Any, Any}-developer_documentation-internal_docstrings" href="#Mooncake.@is_primitive-Tuple{Any, Any}-developer_documentation-internal_docstrings"><code>Mooncake.@is_primitive</code></a> — <span class="docstring-category">Macro</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">@is_primitive context_type signature</code></pre><p>Creates a method of <code>is_primitive</code> which always returns <code>true</code> for the context_type and <code>signature</code> provided. For example</p><pre><code class="language-julia hljs">@is_primitive MinimalCtx Tuple{typeof(foo), Float64}</code></pre><p>is equivalent to</p><pre><code class="language-julia hljs">is_primitive(::Type{MinimalCtx}, ::Type{&lt;:Tuple{typeof(foo), Float64}}) = true</code></pre><p>You should implemented more complicated method of <code>is_primitive</code> in the usual way.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/compintell/Mooncake.jl/blob/9f19358ec93a14f67ccd63773de4a19f4c9f35fd/src/interpreter/contexts.jl#L38-L52">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Mooncake.@mooncake_overlay-Tuple{Any}-developer_documentation-internal_docstrings" href="#Mooncake.@mooncake_overlay-Tuple{Any}-developer_documentation-internal_docstrings"><code>Mooncake.@mooncake_overlay</code></a> — <span class="docstring-category">Macro</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">@mooncake_overlay method_expr</code></pre><p>Define a method of a function which only Mooncake can see. This can be used to write versions of methods which can be successfully differentiated by Mooncake if the original cannot be.</p><p>For example, suppose that you have a function</p><pre><code class="language-julia-repl hljs">julia&gt; foo(x::Float64) = bar(x)
foo (generic function with 1 method)</code></pre><p>where Mooncake.jl fails to differentiate <code>bar</code> for some reason. If you have access to another function <code>baz</code>, which does the same thing as <code>bar</code>, but does     so in a way which Mooncake.jl can differentiate, you can simply write:</p><pre><code class="language-julia-repl hljs">julia&gt; Mooncake.@mooncake_overlay foo(x::Float64) = baz(x)
</code></pre><p>When looking up the code for <code>foo(::Float64)</code>, Mooncake.jl will see this method, rather than the original, and differentiate it instead.</p><p><strong>A Worked Example</strong></p><p>To demonstrate how to use <code>@mooncake_overlay</code>s in practice, we here demonstrate how the answer that Mooncake.jl gives changes if you change the definition of a function using a <code>@mooncake_overlay</code>. Do not do this in practice – this is just a simple way to demonostrate how to use overlays!</p><p>First, consider a simple example:</p><pre><code class="language-julia-repl hljs">julia&gt; scale(x) = 2x
scale (generic function with 1 method)

julia&gt; rule = Mooncake.build_rrule(Tuple{typeof(scale), Float64});

julia&gt; Mooncake.value_and_gradient!!(rule, scale, 5.0)
(10.0, (NoTangent(), 2.0))</code></pre><p>We can use <code>@mooncake_overlay</code> to change the definition which Mooncake.jl sees:</p><pre><code class="language-julia-repl hljs">julia&gt; Mooncake.@mooncake_overlay scale(x) = 3x

julia&gt; rule = Mooncake.build_rrule(Tuple{typeof(scale), Float64});

julia&gt; Mooncake.value_and_gradient!!(rule, scale, 5.0)
(15.0, (NoTangent(), 3.0))</code></pre><p>As can be seen from the output, the result of differentiating using Mooncake.jl has changed to reflect the overlay-ed definition of the method.</p><p>Additionally, it is possible to use the usual multi-line syntax to declare an overlay:</p><pre><code class="language-julia-repl hljs">julia&gt; Mooncake.@mooncake_overlay function scale(x)
           return 4x
       end

julia&gt; rule = Mooncake.build_rrule(Tuple{typeof(scale), Float64});

julia&gt; Mooncake.value_and_gradient!!(rule, scale, 5.0)
(20.0, (NoTangent(), 4.0))</code></pre></div><a class="docs-sourcelink" target="_blank" href="https://github.com/compintell/Mooncake.jl/blob/9f19358ec93a14f67ccd63773de4a19f4c9f35fd/src/tools_for_rules.jl#L33-L96">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Mooncake.@zero_adjoint-Tuple{Any, Any}-developer_documentation-internal_docstrings" href="#Mooncake.@zero_adjoint-Tuple{Any, Any}-developer_documentation-internal_docstrings"><code>Mooncake.@zero_adjoint</code></a> — <span class="docstring-category">Macro</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">@zero_adjoint ctx sig</code></pre><p>Defines <code>is_primitive(context_type, sig) = true</code>, and defines a method of <code>Mooncake.rrule!!</code> which returns zero for all inputs. Users of ChainRules.jl should be familiar with this functionality – it is morally the same as <code>ChainRulesCore.@non_differentiable</code>.</p><p>For example:</p><pre><code class="language-julia-repl hljs">julia&gt; using Mooncake: @zero_adjoint, DefaultCtx, zero_fcodual, rrule!!, is_primitive

julia&gt; foo(x) = 5
foo (generic function with 1 method)

julia&gt; @zero_adjoint DefaultCtx Tuple{typeof(foo), Any}

julia&gt; is_primitive(DefaultCtx, Tuple{typeof(foo), Any})
true

julia&gt; rrule!!(zero_fcodual(foo), zero_fcodual(3.0))[2](NoRData())
(NoRData(), 0.0)</code></pre><p>Limited support for <code>Vararg</code>s is also available. For example</p><pre><code class="language-julia-repl hljs">julia&gt; using Mooncake: @zero_adjoint, DefaultCtx, zero_fcodual, rrule!!, is_primitive

julia&gt; foo_varargs(x...) = 5
foo_varargs (generic function with 1 method)

julia&gt; @zero_adjoint DefaultCtx Tuple{typeof(foo_varargs), Vararg}

julia&gt; is_primitive(DefaultCtx, Tuple{typeof(foo_varargs), Any, Float64, Int})
true

julia&gt; rrule!!(zero_fcodual(foo_varargs), zero_fcodual(3.0), zero_fcodual(5))[2](NoRData())
(NoRData(), 0.0, NoRData())</code></pre><p>Be aware that it is not currently possible to specify any of the type parameters of the <code>Vararg</code>. For example, the signature <code>Tuple{typeof(foo), Vararg{Float64, 5}}</code> will not work with this macro.</p><p>WARNING: this is only correct if the output of the function does not alias any fields of the function, or any of its arguments. For example, applying this macro to the function <code>x -&gt; x</code> will yield incorrect results.</p><p>As always, you should use <a href="../../utilities/debugging_and_mwes/#Mooncake.TestUtils.test_rule"><code>TestUtils.test_rule</code></a> to ensure that you&#39;ve not made a mistake.</p><p><strong>Signatures Unsupported By This Macro</strong></p><p>If the signature you wish to apply <code>@zero_adjoint</code> to is not supported, for example because it uses a <code>Vararg</code> with a type parameter, you can still make use of <a href="../../utilities/tools_for_rules/#Mooncake.zero_adjoint"><code>zero_adjoint</code></a>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/compintell/Mooncake.jl/blob/9f19358ec93a14f67ccd63773de4a19f4c9f35fd/src/tools_for_rules.jl#L141-L196">source</a></section></article></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../developer_tools/">« Developer Tools</a><a class="docs-footer-nextpage" href="../../known_limitations/">Known Limitations »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.8.0 on <span class="colophon-date" title="Wednesday 20 November 2024 15:41">Wednesday 20 November 2024</span>. Using Julia version 1.11.1.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
